# ADR-002：採用語意感知的遞迴分塊策略

## Status
Accepted（2026-01-25）

## Context
文件分塊（Chunking）直接影響檢索品質。
測試了三種策略：
- 固定大小分塊（Fixed-size）：每塊 512 tokens，重疊 64 tokens
- 語意分塊（Semantic）：使用 NLP 偵測段落邊界
- 遞迴分塊（Recursive）：先按段落，段落太長再按句子

測試結果（用 100 個業務問題評估）：
- 固定大小：Hit@3 = 71%（常在句子中間切斷，語意斷裂）
- 語意分塊：Hit@3 = 83%（但處理速度慢 3 倍）
- 遞迴分塊：Hit@3 = 81%（速度快，語意完整性佳）

## Decision
採用遞迴分塊，參數：
- 主分隔符：段落（\n\n）→ 句子（。！？）→ 詞（，）→ 字元
- 目標大小：600 tokens
- 重疊大小：100 tokens（保留跨塊上下文）

## Consequences
正面：尊重文件的自然段落結構，語意完整
負面：不同文件的 chunk 大小不均，需要在 metadata 記錄實際大小
