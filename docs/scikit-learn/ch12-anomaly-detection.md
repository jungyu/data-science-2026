# ç¬¬ 12 ç« ï¼šç•°å¸¸åµæ¸¬ â€”â€” æ‰¾å‡ºé‚£äº›ã€Œä¸å°å‹ã€çš„è³‡æ–™

## ğŸ¯ æœ¬ç« ç›®æ¨™

è®€å®Œæœ¬ç« å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š

1. ç†è§£ç•°å¸¸åµæ¸¬åœ¨æ©Ÿå™¨å­¸ç¿’ä¸­çš„ç¨ç‰¹å®šä½
2. å€åˆ†ã€Œé›¢ç¾¤å€¼åµæ¸¬ã€èˆ‡ã€Œæ–°ç©å€¼åµæ¸¬ã€
3. ä½¿ç”¨ Isolation Forest åµæ¸¬ç•°å¸¸
4. ä½¿ç”¨ Local Outlier Factor (LOF) åµæ¸¬ç•°å¸¸
5. ç†è§£ One-Class SVM çš„åŸºæœ¬æ¦‚å¿µ
6. åœ¨ã€Œæ²’æœ‰æ¨™ç±¤ã€çš„æƒ…æ³ä¸‹è©•ä¼°ç•°å¸¸åµæ¸¬æ¨¡å‹
7. å®Œæˆä¸€å€‹è©æ¬ºäº¤æ˜“åµæ¸¬æ¡ˆä¾‹

---

## ML ä¸åªæ˜¯åˆ†é¡ï¼

åˆ°ç›®å‰ç‚ºæ­¢ï¼Œæˆ‘å€‘å­¸äº†å¾ˆå¤šæ©Ÿå™¨å­¸ç¿’æ–¹æ³•ï¼š

```
+-----------------------------------------------------------+
|                 æ©Ÿå™¨å­¸ç¿’çš„ä¸–ç•Œåœ°åœ–                            |
+-----------------------------------------------------------+
|                                                           |
|  ç›£ç£å¼å­¸ç¿’                                                |
|  â”œâ”€â”€ åˆ†é¡ï¼šåƒåœ¾éƒµä»¶ã€åœ–ç‰‡è¾¨è­˜ã€å®¢æˆ¶æµå¤±é æ¸¬                  |
|  â””â”€â”€ å›æ­¸ï¼šæˆ¿åƒ¹é æ¸¬ã€éŠ·å”®é æ¸¬                               |
|                                                           |
|  éç›£ç£å¼å­¸ç¿’                                               |
|  â”œâ”€â”€ åˆ†ç¾¤ï¼šå®¢æˆ¶åˆ†ç¾¤ï¼ˆç¬¬ 10 ç« ï¼‰                              |
|  â”œâ”€â”€ é™ç¶­ï¼šPCAï¼ˆç¬¬ 11 ç« ï¼‰                                  |
|  â””â”€â”€ ç•°å¸¸åµæ¸¬ï¼šè©æ¬ºåµæ¸¬ã€æ•…éšœåµæ¸¬  â† ä½ åœ¨é€™è£¡ï¼             |
|                                                           |
+-----------------------------------------------------------+
```

**ç•°å¸¸åµæ¸¬ï¼ˆAnomaly Detectionï¼‰** çš„ç›®æ¨™æ˜¯ï¼š

> æ‰¾å‡ºã€Œè·Ÿå¤§å¤šæ•¸è³‡æ–™ä¸ä¸€æ¨£ã€çš„è³‡æ–™é»ã€‚

```
  æ­£å¸¸è³‡æ–™çš„åˆ†å¸ƒï¼š

      . . . . .
    . . . . . . .
   . . . . . . . .
    . . . . . . .            *  â† ç•°å¸¸ï¼é€™å€‹é»é›¢ç¾¤é«”å¾ˆé 
      . . . . .
    . . . . . . .
      . . . . .
```

---

## ğŸ’¡ é‡é»è§€å¿µï¼šç‚ºä»€éº¼ä¸ç›´æ¥ç”¨åˆ†é¡ï¼Ÿ

ä½ å¯èƒ½æœƒæƒ³ï¼šã€Œç•°å¸¸ vs æ­£å¸¸ã€ä¸å°±æ˜¯äºŒå…ƒåˆ†é¡å—ï¼Ÿ
ç”¨ Logistic Regression æˆ– Random Forest ä¸è¡Œå—ï¼Ÿ

ç­”æ¡ˆæ˜¯ï¼š**é€šå¸¸ä¸è¡Œï¼Œå› ç‚ºç¾å¯¦ä¸­çš„ç•°å¸¸åµæ¸¬æœ‰ä¸‰å¤§å›°é›£ã€‚**

```
+-----------------------------------------------------+
|   ç•°å¸¸åµæ¸¬ vs äºŒå…ƒåˆ†é¡çš„å·®ç•°                            |
+-----------------------------------------------------+
|                                                     |
|   å›°é›£ 1ï¼šæ¥µåº¦ä¸å¹³è¡¡                                  |
|   æ­£å¸¸äº¤æ˜“ï¼š99.97%                                   |
|   è©æ¬ºäº¤æ˜“ï¼š0.03%                                    |
|   â†’ åˆ†é¡å™¨å­¸åˆ°ã€Œå…¨éƒ¨çŒœæ­£å¸¸ã€å°±æœ‰ 99.97% æº–ç¢ºç‡          |
|                                                     |
|   å›°é›£ 2ï¼šç¼ºä¹æ¨™ç±¤                                    |
|   å¾ˆå¤šç•°å¸¸å¾æœªè¢«ç™¼ç¾é                                 |
|   ä½ æ‰‹ä¸Šå¯èƒ½åªæœ‰ã€Œæ­£å¸¸ã€çš„è³‡æ–™                          |
|                                                     |
|   å›°é›£ 3ï¼šç•°å¸¸çš„å½¢æ…‹ä¸å›ºå®š                              |
|   è©æ¬ºæ‰‹æ³•ä¸æ–·è®ŠåŒ–                                    |
|   æ˜¨å¤©çš„ç•°å¸¸æ¨¡å¼ â‰  æ˜å¤©çš„ç•°å¸¸æ¨¡å¼                      |
|                                                     |
+-----------------------------------------------------+
```

> æƒ³åƒä½ æ˜¯æ©Ÿå ´å®‰æª¢å“¡ã€‚ä½ è¦‹éç„¡æ•¸æ­£å¸¸æ—…å®¢çš„è¡Œç‚ºæ¨¡å¼ï¼Œ
> ä½†ä½ ä¸çŸ¥é“ä¸‹ä¸€å€‹å¯ç–‘è¡Œç‚ºæœƒæ˜¯ä»€éº¼æ¨£å­ã€‚
> ä½ çš„ç­–ç•¥ä¸æ˜¯ã€Œè¨˜ä½æ‰€æœ‰å¯ç–‘è¡Œç‚ºã€ï¼Œ
> è€Œæ˜¯ã€Œè¨˜ä½æ­£å¸¸è¡Œç‚ºçš„æ¨¡å¼ï¼Œç™¼ç¾ä¸ç¬¦åˆçš„å°±æ¨™è¨˜ã€ã€‚
>
> ç•°å¸¸åµæ¸¬å°±æ˜¯é€™å€‹æ€è·¯ã€‚

---

## é›¢ç¾¤å€¼åµæ¸¬ vs æ–°ç©å€¼åµæ¸¬

```
+------------------------+-----------------------------+
|   é›¢ç¾¤å€¼åµæ¸¬            |   æ–°ç©å€¼åµæ¸¬                |
|   (Outlier Detection)  |   (Novelty Detection)      |
+------------------------+-----------------------------+
|                        |                             |
| è¨“ç·´è³‡æ–™ä¸­ã€ŒåŒ…å«ã€ç•°å¸¸  | è¨“ç·´è³‡æ–™ä¸­ã€Œä¸åŒ…å«ã€ç•°å¸¸     |
|                        |                             |
| ç›®æ¨™ï¼šæ‰¾å‡ºè¨“ç·´é›†è£¡      | ç›®æ¨™ï¼šåˆ¤æ–·æ–°ä¾†çš„è³‡æ–™        |
| å“ªäº›æ˜¯ç•°å¸¸             | æ˜¯å¦ç•°å¸¸                    |
|                        |                             |
| å ´æ™¯ï¼šä½ æœ‰ä¸€å †è³‡æ–™ï¼Œ    | å ´æ™¯ï¼šä½ æœ‰ä¹¾æ·¨çš„æ­£å¸¸è³‡æ–™ï¼Œ  |
| ä½†ä¸çŸ¥é“å“ªäº›æ˜¯å£çš„      | è¦åˆ¤æ–·æ–°è³‡æ–™æ­£ä¸æ­£å¸¸        |
|                        |                             |
| ä»£è¡¨ç®—æ³•ï¼š              | ä»£è¡¨ç®—æ³•ï¼š                  |
| - IsolationForest      | - One-Class SVM             |
| - LocalOutlierFactor   | - LOF (novelty=True)       |
|                        |                             |
+------------------------+-----------------------------+
```

```
é›¢ç¾¤å€¼åµæ¸¬çš„æ¯”å–»ï¼š

  ä½ èµ°é€²ä¸€é–“æ•™å®¤ï¼Œè¦æ‰¾å‡ºå“ªäº›åŒå­¸ã€Œä¸æ˜¯é€™å€‹ç­çš„ã€ã€‚
  ä½ ä¸çŸ¥é“å¤–äººé•·ä»€éº¼æ¨£ï¼Œä½†ä½ è§€å¯Ÿæ•´é«”æ¨¡å¼å¾Œï¼Œ
  é‚£å€‹ç©¿è‘—ä¸åŒåˆ¶æœçš„äººç‰¹åˆ¥é¡¯çœ¼ã€‚

æ–°ç©å€¼åµæ¸¬çš„æ¯”å–»ï¼š

  ä½ å·²ç¶“èªè­˜ç­ä¸Šæ‰€æœ‰åŒå­¸äº†ã€‚
  ç¾åœ¨æœ‰å€‹æ–°é¢å­”èµ°é€²ä¾†ï¼Œä½ è¦åˆ¤æ–·ã€Œé€™å€‹äººæ˜¯ä¸æ˜¯æ–°ä¾†çš„ã€ã€‚
```

---

## Isolation Forestï¼šç”¨ã€Œéš”é›¢ã€æ‰¾ç•°å¸¸

### æ ¸å¿ƒç›´è¦º

**Isolation Forest** çš„æƒ³æ³•æ¥µå…¶å·§å¦™ï¼š

> ç•°å¸¸å€¼å› ç‚ºã€Œå°‘è¦‹ä¸”ä¸åŒã€ï¼Œæ‰€ä»¥ç‰¹åˆ¥å®¹æ˜“è¢«ã€Œéš”é›¢ã€ã€‚

```
æƒ³åƒä½ è¦åœ¨æ£®æ—è£¡æŠ“ä¸€éš»ç‰¹åˆ¥çš„å‹•ç‰©ï¼š

æ­£å¸¸å‹•ç‰©ï¼ˆå¾ˆå¤šã€èšé›†åœ¨ä¸€èµ·ï¼‰ï¼š
éœ€è¦å¾ˆå¤šæ¬¡åˆ†å‰²æ‰èƒ½æŠŠå…¶ä¸­ä¸€éš»å–®ç¨éš”é›¢å‡ºä¾†

  +-----------------------------------+
  |  . . . . . . . . . . . . . .     |
  |  . . . . . . . . . . . . .       |
  |  . . . . . . . . . . . . . .     |
  |  . . . . . . . . . . . .         |
  +-----------------------------------+

  ç¬¬ 1 åˆ€ â†’ é‚„æœ‰å¾ˆå¤šé»åœ¨åŒä¸€é‚Š
  ç¬¬ 2 åˆ€ â†’ é‚„æ˜¯å¾ˆå¤š
  ...
  ç¬¬ 10 åˆ€ â†’ çµ‚æ–¼æŠŠä¸€å€‹é»éš”é›¢å‡ºä¾†

ç•°å¸¸å‹•ç‰©ï¼ˆå°‘è¦‹ã€é é›¢ç¾¤é«”ï¼‰ï¼š
å¾ˆå°‘å¹¾åˆ€å°±èƒ½æŠŠå®ƒéš”é›¢å‡ºä¾†

  +-----------------------------------+
  |  . . . . . . .                    |
  |  . . . . . .          * â† ç•°å¸¸    |
  |  . . . . . . .                    |
  +-----------------------------------+

  ç¬¬ 1 åˆ€ â†’ å°±æŠŠ * å’Œå…¶ä»–é»åˆ†é–‹äº†ï¼

çµè«–ï¼šéš”é›¢æ‰€éœ€çš„ã€Œåˆ€æ•¸ã€è¶Šå°‘ â†’ è¶Šå¯èƒ½æ˜¯ç•°å¸¸å€¼
```

### æ¼”ç®—æ³•æ­¥é©Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Isolation Forest æ¼”ç®—æ³•                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  1. éš¨æ©Ÿé¸ä¸€å€‹ç‰¹å¾µ                                    â”‚
â”‚  2. åœ¨è©²ç‰¹å¾µçš„ç¯„åœå…§éš¨æ©Ÿé¸ä¸€å€‹åˆ†å‰²å€¼                    â”‚
â”‚  3. æŠŠè³‡æ–™åˆ†æˆã€Œå·¦é‚Šã€å’Œã€Œå³é‚Šã€                        â”‚
â”‚  4. å°æ¯ä¸€é‚Šé‡è¤‡ 1-3ï¼Œç›´åˆ°æ¯å€‹é»è¢«éš”é›¢                  â”‚
â”‚  5. è¨˜éŒ„æ¯å€‹é»è¢«éš”é›¢æ‰€éœ€çš„ã€Œè·¯å¾‘é•·åº¦ã€                  â”‚
â”‚                                                     â”‚
â”‚  å»ºå¾ˆå¤šæ£µé€™æ¨£çš„éš¨æ©Ÿæ¨¹ï¼ˆforestï¼‰                        â”‚
â”‚  â†’ å¹³å‡è·¯å¾‘é•·åº¦çŸ­çš„é» = ç•°å¸¸ï¼                         â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### scikit-learn å¯¦ä½œ

```python
import numpy as np
import matplotlib.pyplot as plt
from sklearn.ensemble import IsolationForest
from sklearn.datasets import make_blobs

# ç”¢ç”Ÿè³‡æ–™ï¼šæ­£å¸¸é» + ç•°å¸¸é»
np.random.seed(42)
X_normal, _ = make_blobs(n_samples=300, centers=1,
                          cluster_std=0.5, random_state=42)
X_outliers = np.random.uniform(low=-4, high=4, size=(20, 2))
X = np.vstack([X_normal, X_outliers])

print(f"ç¸½è³‡æ–™é‡ï¼š{len(X)}")
print(f"æ­£å¸¸ï¼š{len(X_normal)}, ç•°å¸¸ï¼š{len(X_outliers)}")
print(f"ç•°å¸¸æ¯”ä¾‹ï¼š{len(X_outliers)/len(X)*100:.1f}%")

# å»ºç«‹ Isolation Forest
iso_forest = IsolationForest(
    n_estimators=100,       # å»º 100 æ£µéš”é›¢æ¨¹
    contamination=0.06,     # é æœŸç•°å¸¸æ¯”ä¾‹ï¼ˆâ‰ˆ 20/320ï¼‰
    random_state=42
)

# è¨“ç·´ + é æ¸¬
labels = iso_forest.fit_predict(X)
# labels: 1 = æ­£å¸¸, -1 = ç•°å¸¸

n_outliers = (labels == -1).sum()
print(f"\nåµæ¸¬åˆ° {n_outliers} å€‹ç•°å¸¸é»")
```

### è¦–è¦ºåŒ–çµæœ

```python
plt.figure(figsize=(10, 6))

# æ­£å¸¸é»
plt.scatter(X[labels == 1, 0], X[labels == 1, 1],
            c='blue', s=20, alpha=0.5, label='æ­£å¸¸')

# ç•°å¸¸é»
plt.scatter(X[labels == -1, 0], X[labels == -1, 1],
            c='red', s=50, marker='x', label='ç•°å¸¸')

plt.title('Isolation Forest ç•°å¸¸åµæ¸¬çµæœ')
plt.xlabel('ç‰¹å¾µ 1')
plt.ylabel('ç‰¹å¾µ 2')
plt.legend()
plt.show()
```

### ç•°å¸¸åˆ†æ•¸

```python
# score_samplesï¼šè¶Šä½è¶Šç•°å¸¸
scores = iso_forest.score_samples(X)

plt.figure(figsize=(10, 4))
plt.hist(scores, bins=50, edgecolor='black', alpha=0.7)
plt.axvline(x=np.percentile(scores, 6), color='red',
            linestyle='--', label='ç•°å¸¸é–¾å€¼')
plt.xlabel('ç•°å¸¸åˆ†æ•¸ï¼ˆè¶Šä½è¶Šç•°å¸¸ï¼‰')
plt.ylabel('è³‡æ–™é»æ•¸é‡')
plt.title('Isolation Forest ç•°å¸¸åˆ†æ•¸åˆ†å¸ƒ')
plt.legend()
plt.show()
```

---

## ğŸ’¡ é‡é»è§€å¿µï¼šcontamination åƒæ•¸

```
+-----------------------------------------------------+
|   contamination = ä½ ã€Œé æœŸã€è³‡æ–™ä¸­æœ‰å¤šå°‘æ¯”ä¾‹æ˜¯ç•°å¸¸       |
+-----------------------------------------------------+
|                                                     |
|   contamination=0.01  â†’  é æœŸ 1% æ˜¯ç•°å¸¸               |
|   contamination=0.05  â†’  é æœŸ 5% æ˜¯ç•°å¸¸               |
|   contamination=0.10  â†’  é æœŸ 10% æ˜¯ç•°å¸¸              |
|   contamination='auto' â†’ ç”±æ¼”ç®—æ³•è‡ªå‹•æ±ºå®š              |
|                                                     |
|   é€™å€‹åƒæ•¸æœƒå½±éŸ¿ã€Œç•°å¸¸é–¾å€¼ã€çš„ä½ç½®ï¼š                     |
|   contamination è¶Šå¤§ â†’ è¢«æ¨™ç‚ºç•°å¸¸çš„é»è¶Šå¤š               |
|   contamination è¶Šå° â†’ åªæœ‰æœ€æ¥µç«¯çš„é»æ‰è¢«æ¨™ç‚ºç•°å¸¸        |
|                                                     |
|   ä¸ç¢ºå®šçš„è©±ï¼Œå¾ 'auto' æˆ–å°å€¼ï¼ˆå¦‚ 0.01ï¼‰é–‹å§‹          |
+-----------------------------------------------------+
```

---

## ğŸ§  å‹•å‹•è…¦

> Isolation Forest ç”¨äº†ã€Œéš¨æ©Ÿåˆ†å‰²ã€çš„ç­–ç•¥ã€‚
> ç‚ºä»€éº¼éš¨æ©Ÿåè€Œæœ‰æ•ˆï¼Ÿå¦‚æœç”¨ä¸€èˆ¬çš„æ±ºç­–æ¨¹ï¼ˆä¸éš¨æ©Ÿï¼‰ï¼Œæ•ˆæœæœƒæ›´å¥½å—ï¼Ÿ
>
> æç¤ºï¼šæƒ³æƒ³éš¨æ©Ÿæ£®æ—ï¼ˆRandom Forestï¼‰ç‚ºä»€éº¼è¦ç”¨éš¨æ©Ÿ......
>
> ï¼ˆç­”æ¡ˆåœ¨æœ¬ç« æœ€å¾Œï¼‰

---

## Local Outlier Factor (LOF)

### æ ¸å¿ƒç›´è¦º

LOF çš„æƒ³æ³•è·Ÿ Isolation Forest å®Œå…¨ä¸åŒï¼š

> æ¯”è¼ƒä¸€å€‹é»çš„ã€Œé„°åŸŸå¯†åº¦ã€å’Œå®ƒé„°å±…çš„ã€Œé„°åŸŸå¯†åº¦ã€ã€‚
> å¦‚æœä¸€å€‹é»çš„å¯†åº¦æ˜é¡¯æ¯”é„°å±…ä½ â†’ ç•°å¸¸ï¼

```
  LOF çš„ç›´è¦ºï¼š

  å¯†é›†å€åŸŸï¼š                    ç¨€ç–å€åŸŸï¼š
  . . . . .                    .
  . . . . .
  . . o . .  â† o å’Œé„°å±…
  . . . . .    å¯†åº¦å·®ä¸å¤š       .    *    .    â† * çš„é„°å±…å¯†åº¦
  . . . . .    â†’ LOF â‰ˆ 1             .        æ¯” * è‡ªå·±é«˜å¾ˆå¤š
                â†’ æ­£å¸¸                          â†’ LOF >> 1
                                                â†’ ç•°å¸¸ï¼

  é—œéµå·®ç•°ï¼šLOF å¯ä»¥åµæ¸¬ã€Œç›¸å°å¯†åº¦ã€çš„ç•°å¸¸
  â†’ å°±ç®—ä¸€å€‹é»ä¸æ˜¯çœŸçš„å¾ˆã€Œé ã€ï¼Œä½†å¦‚æœå®ƒåœ¨å¯†é›†å€åŸŸçš„é‚Šç·£ï¼Œ
     LOF ä¹Ÿèƒ½æŠ“åˆ°å®ƒï¼
```

### LOF vs Isolation Forest

```
+---------------------+---------------------------+
|   Isolation Forest  |   LOF                     |
+---------------------+---------------------------+
| å…¨å±€æ–¹æ³•            | å±€éƒ¨æ–¹æ³•                  |
| çœ‹ã€Œéš”é›¢é›£æ˜“åº¦ã€     | çœ‹ã€Œé„°åŸŸå¯†åº¦ã€            |
| æ“…é•·å…¨å±€ç•°å¸¸        | æ“…é•·å±€éƒ¨ç•°å¸¸              |
| å¯ä»¥ predict æ–°è³‡æ–™ | é è¨­åªèƒ½ç”¨åœ¨è¨“ç·´è³‡æ–™      |
| è¼ƒå¿«ï¼ˆO(n log n)ï¼‰  | è¼ƒæ…¢ï¼ˆO(n * k)ï¼‰          |
+---------------------+---------------------------+
```

### scikit-learn å¯¦ä½œ

```python
from sklearn.neighbors import LocalOutlierFactor

# é›¢ç¾¤å€¼åµæ¸¬æ¨¡å¼ï¼ˆé è¨­ï¼‰
lof = LocalOutlierFactor(
    n_neighbors=20,         # çœ‹ 20 å€‹é„°å±…
    contamination=0.06,     # é æœŸ 6% ç•°å¸¸
)

# æ³¨æ„ï¼šLOF åªæœ‰ fit_predictï¼Œæ²’æœ‰å–®ç¨çš„ predictï¼
labels_lof = lof.fit_predict(X)
# labels: 1 = æ­£å¸¸, -1 = ç•°å¸¸

n_outliers_lof = (labels_lof == -1).sum()
print(f"LOF åµæ¸¬åˆ° {n_outliers_lof} å€‹ç•°å¸¸é»")

# å–å¾—ç•°å¸¸åˆ†æ•¸ï¼ˆè² å€¼è¶Šå¤§è¶Šç•°å¸¸ï¼‰
scores_lof = lof.negative_outlier_factor_
print(f"ç•°å¸¸åˆ†æ•¸ç¯„åœï¼š{scores_lof.min():.2f} ~ {scores_lof.max():.2f}")
```

### è¦–è¦ºåŒ– LOF çµæœ

```python
plt.figure(figsize=(10, 6))

# ç”¨ LOF åˆ†æ•¸çš„å¤§å°ä¾†æ±ºå®šé»çš„å¤§å°
sizes = np.abs(scores_lof) * 10

plt.scatter(X[labels_lof == 1, 0], X[labels_lof == 1, 1],
            c='blue', s=20, alpha=0.5, label='æ­£å¸¸')
plt.scatter(X[labels_lof == -1, 0], X[labels_lof == -1, 1],
            c='red', s=100, marker='x', label='ç•°å¸¸')

plt.title('Local Outlier Factor ç•°å¸¸åµæ¸¬çµæœ')
plt.xlabel('ç‰¹å¾µ 1')
plt.ylabel('ç‰¹å¾µ 2')
plt.legend()
plt.show()
```

---

## One-Class SVMï¼ˆç°¡ä»‹ï¼‰

One-Class SVM æ˜¯å¦ä¸€ç¨®ç•°å¸¸åµæ¸¬æ–¹æ³•ï¼Œé©åˆ **æ–°ç©å€¼åµæ¸¬**ã€‚

### æ ¸å¿ƒç›´è¦º

```
  æ™®é€š SVMï¼šåœ¨å…©ç¾¤è³‡æ–™ä¹‹é–“ç•«åˆ†ç•Œç·š

     o o o | x x x
     o o o | x x x
     o o   | x x x
           |
         åˆ†ç•Œç·š

  One-Class SVMï¼šåœ¨ã€Œæ­£å¸¸è³‡æ–™ã€å‘¨åœç•«ä¸€å€‹é‚Šç•Œ

        ___________
       /           \
      / o o o o o   \
     | o o o o o o   |
     | o o o o o     |
      \ o o o o o   /
       \___________/
                      * â† é‚Šç•Œå¤– = ç•°å¸¸ï¼
```

### ç°¡å–®ç¯„ä¾‹

```python
from sklearn.svm import OneClassSVM

# One-Class SVM é©åˆã€Œæ–°ç©å€¼åµæ¸¬ã€
# è¨“ç·´æ™‚åªçµ¦æ­£å¸¸è³‡æ–™ï¼
oc_svm = OneClassSVM(
    kernel='rbf',
    gamma='scale',
    nu=0.06,           # é¡ä¼¼ contamination
)

# åªç”¨æ­£å¸¸è³‡æ–™è¨“ç·´
oc_svm.fit(X_normal)

# å°æ‰€æœ‰è³‡æ–™é æ¸¬
labels_svm = oc_svm.predict(X)

n_outliers_svm = (labels_svm == -1).sum()
print(f"One-Class SVM åµæ¸¬åˆ° {n_outliers_svm} å€‹ç•°å¸¸é»")
```

```
+-----------------------------------------------------+
|   ä¸‰ç¨®æ–¹æ³•æ¯”è¼ƒ                                        |
+-----------------------------------------------------+
|                                                     |
|   æ–¹æ³•             é©åˆå ´æ™¯          é€Ÿåº¦    æº–ç¢ºåº¦    |
|   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    |
|   IsolationForest  é€šç”¨ã€å¤§è³‡æ–™é›†    å¿«      å¥½       |
|   LOF              å±€éƒ¨å¯†åº¦ç•°å¸¸      ä¸­ç­‰    å¥½       |
|   One-Class SVM    å°è³‡æ–™é›†ã€é«˜ç¶­    æ…¢      å¾ˆå¥½     |
|                                                     |
|   æ¨è–¦èµ·æ‰‹å¼ï¼šå…ˆè©¦ IsolationForest                    |
|   â†’ æ•ˆæœä¸å¥½å†è©¦ LOF                                 |
|   â†’ å¦‚æœæœ‰ä¹¾æ·¨çš„è¨“ç·´è³‡æ–™ï¼Œè€ƒæ…® One-Class SVM          |
|                                                     |
+-----------------------------------------------------+
```

---

## ğŸ”¥ å¯¦æˆ°æ¡ˆä¾‹ï¼šè©æ¬ºäº¤æ˜“åµæ¸¬

### æƒ…å¢ƒ

ä½ æ˜¯ä¸€å®¶éŠ€è¡Œçš„è³‡æ–™ç§‘å­¸å®¶ï¼Œéœ€è¦å¾äº¤æ˜“ç´€éŒ„ä¸­æ‰¾å‡ºå¯ç–‘çš„è©æ¬ºäº¤æ˜“ã€‚

### è³‡æ–™æº–å‚™

```python
import pandas as pd
from sklearn.preprocessing import StandardScaler

# æ¨¡æ“¬äº¤æ˜“è³‡æ–™
np.random.seed(42)
n_normal = 9700
n_fraud = 300   # 3% çš„äº¤æ˜“æ˜¯è©æ¬º

# æ­£å¸¸äº¤æ˜“
normal_txns = pd.DataFrame({
    'äº¤æ˜“é‡‘é¡': np.random.lognormal(mean=6, sigma=1, size=n_normal),
    'äº¤æ˜“æ™‚é–“_å°æ™‚': np.random.normal(14, 4, n_normal).clip(0, 23),
    'è·ä¸Šæ¬¡äº¤æ˜“_åˆ†é˜': np.random.exponential(120, n_normal),
    'å•†åº—é¡åˆ¥æ•¸': np.random.poisson(3, n_normal),
    'æ˜¯å¦è©æ¬º': 0,
})

# è©æ¬ºäº¤æ˜“ï¼ˆé‡‘é¡åé«˜ã€æ™‚é–“ååŠå¤œã€é »ç‡ç•°å¸¸é«˜ï¼‰
fraud_txns = pd.DataFrame({
    'äº¤æ˜“é‡‘é¡': np.random.lognormal(mean=8, sigma=1.5, size=n_fraud),
    'äº¤æ˜“æ™‚é–“_å°æ™‚': np.random.normal(3, 2, n_fraud).clip(0, 23),
    'è·ä¸Šæ¬¡äº¤æ˜“_åˆ†é˜': np.random.exponential(10, n_fraud),
    'å•†åº—é¡åˆ¥æ•¸': np.random.poisson(8, n_fraud),
    'æ˜¯å¦è©æ¬º': 1,
})

data = pd.concat([normal_txns, fraud_txns], ignore_index=True)
data = data.sample(frac=1, random_state=42).reset_index(drop=True)

print(f"ç¸½äº¤æ˜“æ•¸ï¼š{len(data)}")
print(f"è©æ¬ºæ¯”ä¾‹ï¼š{data['æ˜¯å¦è©æ¬º'].mean()*100:.1f}%")
print(f"\nå„æ¬„ä½çµ±è¨ˆï¼š")
print(data.describe().round(1))
```

### ç‰¹å¾µå·¥ç¨‹èˆ‡æ¨™æº–åŒ–

```python
features = ['äº¤æ˜“é‡‘é¡', 'äº¤æ˜“æ™‚é–“_å°æ™‚', 'è·ä¸Šæ¬¡äº¤æ˜“_åˆ†é˜', 'å•†åº—é¡åˆ¥æ•¸']
X = data[features].values
y_true = data['æ˜¯å¦è©æ¬º'].values  # å¯¦éš›ä¸­æˆ‘å€‘ã€Œæ²’æœ‰ã€é€™å€‹ï¼åƒ…ç”¨ä¾†è©•ä¼°

scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)
```

### ç”¨ Isolation Forest åµæ¸¬

```python
iso_forest = IsolationForest(
    n_estimators=200,
    contamination=0.03,     # æˆ‘å€‘çŒœæ¸¬ 3% æ˜¯ç•°å¸¸
    random_state=42
)

pred_labels = iso_forest.fit_predict(X_scaled)
# è½‰æ›ï¼š-1 â†’ 1ï¼ˆç•°å¸¸ï¼‰ï¼Œ1 â†’ 0ï¼ˆæ­£å¸¸ï¼‰
pred_fraud = (pred_labels == -1).astype(int)

# å› ç‚ºæˆ‘å€‘ï¼ˆå·å·åœ°ï¼‰æœ‰æ¨™ç±¤ï¼Œå¯ä»¥è©•ä¼°
from sklearn.metrics import (classification_report,
                              confusion_matrix)

print("Isolation Forest çµæœï¼š")
print(confusion_matrix(y_true, pred_fraud))
print(classification_report(y_true, pred_fraud,
                            target_names=['æ­£å¸¸', 'è©æ¬º']))
```

```
é æœŸæ··æ·†çŸ©é™£ï¼š

              é æ¸¬æ­£å¸¸   é æ¸¬è©æ¬º
  å¯¦éš›æ­£å¸¸     9500      200      â† éƒ¨åˆ†æ­£å¸¸è¢«èª¤åˆ¤ç‚ºè©æ¬º
  å¯¦éš›è©æ¬º      100      200      â† æŠ“åˆ°äº†å¤§éƒ¨åˆ†è©æ¬ºï¼

æ³¨æ„ï¼šåœ¨ç•°å¸¸åµæ¸¬ä¸­ï¼Œrecallï¼ˆå¬å›ç‡ï¼‰é€šå¸¸æ¯” precision æ›´é‡è¦
â†’ å¯§å¯å¤šæŸ¥å¹¾ç­†æ­£å¸¸äº¤æ˜“ï¼Œä¹Ÿä¸è¦æ”¾éçœŸæ­£çš„è©æ¬ºï¼
```

### ç”¨ LOF åµæ¸¬

```python
lof = LocalOutlierFactor(
    n_neighbors=20,
    contamination=0.03,
)

pred_labels_lof = lof.fit_predict(X_scaled)
pred_fraud_lof = (pred_labels_lof == -1).astype(int)

print("LOF çµæœï¼š")
print(confusion_matrix(y_true, pred_fraud_lof))
print(classification_report(y_true, pred_fraud_lof,
                            target_names=['æ­£å¸¸', 'è©æ¬º']))
```

### æ¯”è¼ƒå…©ç¨®æ–¹æ³•

```python
from sklearn.metrics import precision_score, recall_score, f1_score

methods = {
    'Isolation Forest': pred_fraud,
    'LOF': pred_fraud_lof,
}

print(f"{'æ–¹æ³•':<20} {'Precision':>10} {'Recall':>10} {'F1':>10}")
print("-" * 52)
for name, preds in methods.items():
    p = precision_score(y_true, preds)
    r = recall_score(y_true, preds)
    f = f1_score(y_true, preds)
    print(f"{name:<20} {p:>10.4f} {r:>10.4f} {f:>10.4f}")
```

---

## âš ï¸ å¸¸è¦‹é™·é˜±

### é™·é˜± 1ï¼šcontamination è¨­å¤ªå¤§æˆ–å¤ªå°

```
  contamination = 0.001ï¼ˆå¤ªå°ï¼‰ï¼š
  â†’ åªæŠ“åˆ°æœ€æ¥µç«¯çš„ç•°å¸¸ï¼Œå¾ˆå¤šè©æ¬ºæ¼æ‰äº†

  contamination = 0.30ï¼ˆå¤ªå¤§ï¼‰ï¼š
  â†’ 30% çš„äº¤æ˜“è¢«æ¨™ç‚ºç•°å¸¸ï¼Œå¤§é‡æ­£å¸¸äº¤æ˜“è¢«èª¤åˆ¤
  â†’ èª¿æŸ¥äººåŠ›å®Œå…¨ä¸å¤ ç”¨ï¼

  æ€éº¼è¾¦ï¼Ÿ
  â†’ å¾æ¥­å‹™çŸ¥è­˜å‡ºç™¼ï¼šæ­·å²è©æ¬ºç‡æ˜¯å¤šå°‘ï¼Ÿ
  â†’ å¦‚æœä¸çŸ¥é“ï¼Œå¾ä¿å®ˆå€¼é–‹å§‹ï¼Œé€æ­¥èª¿æ•´
  â†’ ç”¨ score_samples() å–å¾—é€£çºŒåˆ†æ•¸ï¼Œå†è‡ªå·±è¨­é–¾å€¼
```

### é™·é˜± 2ï¼šæ²’æœ‰åšç‰¹å¾µå·¥ç¨‹

```
+-----------------------------------------------------+
|   ç•°å¸¸åµæ¸¬çš„æ•ˆæœé«˜åº¦ä¾è³´ã€Œç‰¹å¾µå“è³ªã€                     |
+-----------------------------------------------------+
|                                                     |
|   å¥½çš„ç‰¹å¾µï¼ˆèƒ½å€åˆ†æ­£å¸¸ vs ç•°å¸¸ï¼‰ï¼š                      |
|   - äº¤æ˜“é‡‘é¡ / å¹³å‡äº¤æ˜“é‡‘é¡ï¼ˆç›¸å°é‡‘é¡ï¼‰                 |
|   - éæ­£å¸¸ç‡Ÿæ¥­æ™‚é–“äº¤æ˜“ï¼ˆå‡Œæ™¨ 2-5 é»ï¼‰                  |
|   - äº¤æ˜“é »ç‡ï¼ˆ10 åˆ†é˜å…§å¤šç­†äº¤æ˜“ï¼‰                      |
|   - æ–°å•†åº—é¦–æ¬¡äº¤æ˜“                                    |
|                                                     |
|   ä¸å¥½çš„ç‰¹å¾µï¼š                                        |
|   - å®¢æˆ¶ IDï¼ˆé¡åˆ¥å‹ï¼Œä¸é©åˆè·é›¢è¨ˆç®—ï¼‰                   |
|   - äº¤æ˜“åºè™Ÿï¼ˆç„¡æ„ç¾©çš„éå¢æ•¸å­—ï¼‰                       |
|                                                     |
+-----------------------------------------------------+
```

### é™·é˜± 3ï¼šç›´æ¥ç”¨æº–ç¢ºç‡ï¼ˆAccuracyï¼‰è©•ä¼°

```
  ç¸½äº¤æ˜“ 10,000 ç­†ï¼Œå…¶ä¸­ 30 ç­†è©æ¬ºã€‚

  æ¨¡å‹ Aï¼šã€Œå…¨éƒ¨çŒœæ­£å¸¸ã€
  â†’ æº–ç¢ºç‡ = 9970/10000 = 99.7%   â† çœ‹èµ·ä¾†å¾ˆå¥½
  â†’ ä½†ä¸€ç­†è©æ¬ºéƒ½æ²’æŠ“åˆ°ï¼å¬å›ç‡ = 0%

  æ¨¡å‹ Bï¼šã€ŒIsolation Forestã€
  â†’ æº–ç¢ºç‡ = 98.5%                â† çœ‹èµ·ä¾†æ¯”è¼ƒå·®ï¼Ÿ
  â†’ ä½†æŠ“åˆ°äº† 25/30 ç­†è©æ¬ºï¼å¬å›ç‡ = 83.3%

  çµè«–ï¼šåœ¨ç•°å¸¸åµæ¸¬ä¸­ï¼Œä¸è¦çœ‹ accuracyï¼
        çœ‹ precision, recall, F1, å’Œ AUC-PR
```

### é™·é˜± 4ï¼šå¿˜è¨˜ LOF ä¸èƒ½ predict æ–°è³‡æ–™

```python
# Isolation Forestï¼šå¯ä»¥ predict æ–°è³‡æ–™ âœ…
iso_forest.fit(X_train_scaled)
iso_forest.predict(X_new)          # æ²’å•é¡Œï¼

# LOF é è¨­ï¼šåªèƒ½ fit_predict âŒ
lof = LocalOutlierFactor()
lof.fit_predict(X_train_scaled)
# lof.predict(X_new)              # å ±éŒ¯ï¼

# LOF æ–°ç©å€¼åµæ¸¬æ¨¡å¼ï¼šå¯ä»¥ predict æ–°è³‡æ–™ âœ…
lof_novelty = LocalOutlierFactor(novelty=True)
lof_novelty.fit(X_train_scaled)
lof_novelty.predict(X_new)         # æ²’å•é¡Œï¼
```

---

## æ²’æœ‰æ¨™ç±¤æ™‚æ€éº¼è©•ä¼°ï¼Ÿ

çœŸå¯¦å ´æ™¯ä¸­ï¼Œä½ é€šå¸¸ **æ²’æœ‰æ¨™ç±¤**ã€‚é€™æ˜¯ç•°å¸¸åµæ¸¬æœ€å¤§çš„æŒ‘æˆ°ä¹‹ä¸€ã€‚

### ç­–ç•¥ 1ï¼šäººå·¥æŠ½æŸ¥

```
1. ç”¨æ¨¡å‹æ‰¾å‡ºç•°å¸¸åˆ†æ•¸æœ€é«˜çš„ top 100 ç­†
2. ç”±é ˜åŸŸå°ˆå®¶äººå·¥æª¢æŸ¥
3. è¨ˆç®—ã€ŒæŸ¥æº–ç‡ã€ï¼š100 ç­†ä¸­æœ‰å¤šå°‘æ˜¯çœŸç•°å¸¸ï¼Ÿ
4. é€æ­¥èª¿æ•´æ¨¡å‹åƒæ•¸
```

### ç­–ç•¥ 2ï¼šç•°å¸¸åˆ†æ•¸åˆ†å¸ƒ

```python
scores = iso_forest.score_samples(X_scaled)

plt.figure(figsize=(10, 4))
plt.hist(scores, bins=100, edgecolor='black', alpha=0.7)
plt.xlabel('ç•°å¸¸åˆ†æ•¸')
plt.ylabel('é »ç‡')
plt.title('ç•°å¸¸åˆ†æ•¸åˆ†å¸ƒ')
plt.show()

# å¦‚æœåˆ†å¸ƒæœ‰æ˜é¡¯çš„ã€Œé›™å³°ã€æˆ–ã€Œé•·å°¾ã€ï¼Œ
# é‚£éº¼é–¾å€¼å¯ä»¥è¨­åœ¨å…©å€‹å³°ä¹‹é–“
```

### ç­–ç•¥ 3ï¼šæ¯”è¼ƒå¤šç¨®æ–¹æ³•çš„å…±è­˜

```python
# å¦‚æœ Isolation Forest å’Œ LOF éƒ½èªç‚ºæŸç­†æ˜¯ç•°å¸¸
# â†’ é‚£å®ƒæ›´å¯èƒ½çœŸçš„æ˜¯ç•°å¸¸

consensus = ((pred_fraud == 1) & (pred_fraud_lof == 1)).astype(int)
print(f"å…©ç¨®æ–¹æ³•éƒ½èªç‚ºç•°å¸¸çš„äº¤æ˜“æ•¸ï¼š{consensus.sum()}")
```

### ç­–ç•¥ 4ï¼šæ¥­å‹™è¦å‰‡äº¤å‰é©—è­‰

```
å·²çŸ¥çš„æ¥­å‹™è¦å‰‡ï¼š
- å–®ç­†äº¤æ˜“ > $50,000 éœ€è¦é¡å¤–å¯©æŸ¥
- å‡Œæ™¨ 1-5 é»çš„äº¤æ˜“éœ€è¦é¡å¤–å¯©æŸ¥
- åŒä¸€å¼µå¡ 10 åˆ†é˜å…§ > 3 ç­†äº¤æ˜“éœ€è¦é¡å¤–å¯©æŸ¥

â†’ çœ‹çœ‹æ¨¡å‹æ¨™è¨˜çš„ç•°å¸¸å’Œæ¥­å‹™è¦å‰‡æ¨™è¨˜çš„ç•°å¸¸æ˜¯å¦é‡ç–Š
â†’ å¦‚æœé«˜åº¦é‡ç–Šï¼Œèªªæ˜æ¨¡å‹å­¸åˆ°äº†åˆç†çš„æ¨¡å¼
â†’ å¦‚æœæ¨¡å‹é¡å¤–æ‰¾åˆ°æ¥­å‹™è¦å‰‡æ²’æ¶µè“‹çš„ç•°å¸¸ï¼Œå¯èƒ½æ˜¯æ–°ç™¼ç¾ï¼
```

---

## â“ æ²’æœ‰ç¬¨å•é¡Œ

**Qï¼šIsolation Forest å’Œ Random Forest æœ‰é—œä¿‚å—ï¼Ÿ**

Aï¼šåå­—åƒï¼Œä½†æ¦‚å¿µä¸å¤ªä¸€æ¨£ã€‚Random Forest æ˜¯ç›£ç£å¼å­¸ç¿’ï¼ˆéœ€è¦æ¨™ç±¤ï¼‰ï¼Œ
ç”¨ä¾†åˆ†é¡æˆ–å›æ­¸ã€‚Isolation Forest æ˜¯éç›£ç£å¼çš„ï¼Œç”¨éš¨æ©Ÿåˆ†å‰²ä¾†ã€Œéš”é›¢ã€ç•°å¸¸é»ã€‚
å…©è€…éƒ½ç”¨äº†ã€Œå¤šæ£µæ¨¹ã€çš„æ¦‚å¿µï¼Œä½†ç›®çš„å®Œå…¨ä¸åŒã€‚

**Qï¼šcontamination è¨­ç‚º 'auto' æœƒç™¼ç”Ÿä»€éº¼ï¼Ÿ**

Aï¼šscikit-learn çš„ IsolationForest åœ¨ `contamination='auto'` æ™‚ï¼Œ
æœƒä½¿ç”¨åŸå§‹è«–æ–‡ä¸­çš„é–¾å€¼ï¼ˆoffset=0ï¼‰ï¼Œä¸å†è‡ªå‹•ä¼°è¨ˆæ¯”ä¾‹ã€‚
é€šå¸¸å»ºè­°æ ¹æ“šæ¥­å‹™çŸ¥è­˜è¨­å®šå…·é«”çš„ contamination å€¼ã€‚

**Qï¼šç•°å¸¸åµæ¸¬å¯ä»¥ç”¨åœ¨å“ªäº›é ˜åŸŸï¼Ÿ**

Aï¼šå¹¾ä¹ç„¡è™•ä¸åœ¨ï¼

| é ˜åŸŸ | æ‡‰ç”¨ |
|------|------|
| é‡‘è | ä¿¡ç”¨å¡è©æ¬ºã€æ´—éŒ¢åµæ¸¬ã€å…§ç·šäº¤æ˜“ |
| è³‡å®‰ | å…¥ä¾µåµæ¸¬ã€æƒ¡æ„è»Ÿé«”è¡Œç‚ºåˆ†æ |
| è£½é€  | ç”¢å“ç‘•ç–µåµæ¸¬ã€è¨­å‚™æ•…éšœé è­¦ |
| é†«ç™‚ | ç•°å¸¸ç”Ÿç†æŒ‡æ¨™ã€ç½•è¦‹ç–¾ç—…ç¯©æª¢ |
| ç‰©è¯ç¶² | æ„Ÿæ¸¬å™¨ç•°å¸¸ã€ç¶²è·¯æµé‡ç•°å¸¸ |

**Qï¼šLOF çš„ n_neighbors æ€éº¼é¸ï¼Ÿ**

Aï¼šä¸€èˆ¬å¾ 20 é–‹å§‹ã€‚å¤ªå°ï¼ˆå¦‚ 5ï¼‰æœƒå¤ªæ•æ„Ÿï¼ŒæŠŠæ­£å¸¸çš„å±€éƒ¨è®Šç•°ä¹Ÿç•¶ç•°å¸¸ã€‚
å¤ªå¤§ï¼ˆå¦‚ 100ï¼‰æœƒå¤ªé²éˆï¼ŒæŠŠçœŸæ­£çš„ç•°å¸¸ä¹Ÿç•¶æ­£å¸¸ã€‚å¯ä»¥è©¦å¹¾å€‹å€¼æ¯”è¼ƒçµæœã€‚

**Qï¼šå¦‚æœæˆ‘çš„è³‡æ–™æœ‰å¾ˆå¤šé¡åˆ¥å‹ç‰¹å¾µæ€éº¼è¾¦ï¼Ÿ**

Aï¼šIsolation Forest å¯ä»¥è™•ç†ï¼Œä½†æ•ˆæœå¯èƒ½ä¸å¥½ã€‚å»ºè­°å…ˆåšé©ç•¶çš„ç·¨ç¢¼
ï¼ˆå¦‚ Target Encoding æˆ– One-Hot Encodingï¼‰ï¼Œç„¶å¾Œå†åšç•°å¸¸åµæ¸¬ã€‚
ä¹Ÿå¯ä»¥è€ƒæ…®åªç”¨æ•¸å€¼å‹ç‰¹å¾µåšç•°å¸¸åµæ¸¬ï¼Œé¡åˆ¥å‹ç‰¹å¾µç”¨è¦å‰‡åˆ¤æ–·ã€‚

---

## é€²éšï¼šç”¨ç•°å¸¸åˆ†æ•¸åšæ’åº

åœ¨å¯¦å‹™ä¸­ï¼Œæ¯”èµ·ã€Œæ˜¯/ä¸æ˜¯ç•°å¸¸ã€çš„äºŒå…ƒåˆ¤æ–·ï¼Œ
é€šå¸¸æ›´æœ‰ç”¨çš„æ˜¯ã€Œç•°å¸¸ç¨‹åº¦æ’åºã€ã€‚

```python
# å–å¾—æ¯ç­†äº¤æ˜“çš„ç•°å¸¸åˆ†æ•¸
scores = iso_forest.score_samples(X_scaled)

# åŠ åˆ° DataFrame ä¸­
data['ç•°å¸¸åˆ†æ•¸'] = scores
data['ç•°å¸¸æ’å'] = data['ç•°å¸¸åˆ†æ•¸'].rank()

# çœ‹æœ€å¯ç–‘çš„å‰ 20 ç­†
top_suspicious = data.nsmallest(20, 'ç•°å¸¸åˆ†æ•¸')
print("æœ€å¯ç–‘çš„ 20 ç­†äº¤æ˜“ï¼š")
print(top_suspicious[features + ['ç•°å¸¸åˆ†æ•¸', 'æ˜¯å¦è©æ¬º']].to_string())
```

```
+-----------------------------------------------------+
|   ç‚ºä»€éº¼ç”¨æ’åºæ¯”äºŒå…ƒåˆ¤æ–·å¥½ï¼Ÿ                            |
+-----------------------------------------------------+
|                                                     |
|   å‡è¨­ä½ çš„èª¿æŸ¥åœ˜éšŠä¸€å¤©åªèƒ½æŸ¥ 50 ç­†äº¤æ˜“                  |
|                                                     |
|   äºŒå…ƒåˆ¤æ–·ï¼ˆcontamination=0.03ï¼‰ï¼š                    |
|   â†’ æ¨™å‡º 300 ç­†ç•°å¸¸ï¼Œä½†ä½ åªèƒ½æŸ¥ 50 ç­†                  |
|   â†’ æŸ¥å“ª 50 ç­†ï¼Ÿéš¨æ©Ÿé¸å—ï¼Ÿ                            |
|                                                     |
|   æ’åºæ–¹æ³•ï¼š                                          |
|   â†’ ä¾ç•°å¸¸åˆ†æ•¸æ’åºï¼ŒæŸ¥æœ€å¯ç–‘çš„å‰ 50 ç­†                  |
|   â†’ æŠŠæœ‰é™çš„è³‡æºç”¨åœ¨ã€Œæœ€å¯ç–‘ã€çš„äº¤æ˜“ä¸Š                  |
|   â†’ æ•ˆç‡å¤§å¹…æå‡ï¼                                    |
|                                                     |
+-----------------------------------------------------+
```

---

## å®Œæ•´ç¨‹å¼ç¢¼ç¯„ä¾‹

```python
"""
ç•°å¸¸åµæ¸¬å®Œæ•´æµç¨‹ï¼šè©æ¬ºäº¤æ˜“åµæ¸¬
"""
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.ensemble import IsolationForest
from sklearn.neighbors import LocalOutlierFactor
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import classification_report, f1_score

# 1. ç”¢ç”Ÿæ¨¡æ“¬è³‡æ–™
np.random.seed(42)
n_normal, n_fraud = 9700, 300

normal = pd.DataFrame({
    'é‡‘é¡': np.random.lognormal(6, 1, n_normal),
    'æ™‚é–“': np.random.normal(14, 4, n_normal).clip(0, 23),
    'é–“éš”': np.random.exponential(120, n_normal),
    'é¡åˆ¥æ•¸': np.random.poisson(3, n_normal),
    'è©æ¬º': 0,
})
fraud = pd.DataFrame({
    'é‡‘é¡': np.random.lognormal(8, 1.5, n_fraud),
    'æ™‚é–“': np.random.normal(3, 2, n_fraud).clip(0, 23),
    'é–“éš”': np.random.exponential(10, n_fraud),
    'é¡åˆ¥æ•¸': np.random.poisson(8, n_fraud),
    'è©æ¬º': 1,
})

data = pd.concat([normal, fraud]).sample(frac=1, random_state=42)
features = ['é‡‘é¡', 'æ™‚é–“', 'é–“éš”', 'é¡åˆ¥æ•¸']
X = data[features].values
y = data['è©æ¬º'].values

# 2. æ¨™æº–åŒ–
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# 3. Isolation Forest
iso = IsolationForest(n_estimators=200, contamination=0.03,
                       random_state=42)
pred_iso = (iso.fit_predict(X_scaled) == -1).astype(int)

# 4. LOF
lof = LocalOutlierFactor(n_neighbors=20, contamination=0.03)
pred_lof = (lof.fit_predict(X_scaled) == -1).astype(int)

# 5. æ¯”è¼ƒçµæœ
print("=" * 50)
print("Isolation Forest:")
print(classification_report(y, pred_iso, target_names=['æ­£å¸¸', 'è©æ¬º']))

print("=" * 50)
print("Local Outlier Factor:")
print(classification_report(y, pred_lof, target_names=['æ­£å¸¸', 'è©æ¬º']))

# 6. å…±è­˜æ–¹æ³•
consensus = ((pred_iso == 1) & (pred_lof == 1)).astype(int)
print("=" * 50)
print("å…±è­˜æ–¹æ³•ï¼ˆå…©è€…éƒ½åˆ¤å®šç‚ºç•°å¸¸ï¼‰ï¼š")
print(classification_report(y, consensus, target_names=['æ­£å¸¸', 'è©æ¬º']))

# 7. ç•°å¸¸åˆ†æ•¸æ’åº
scores = iso.score_samples(X_scaled)
data_result = data.copy()
data_result['ç•°å¸¸åˆ†æ•¸'] = scores
print("\næœ€å¯ç–‘çš„ 10 ç­†äº¤æ˜“ï¼š")
print(data_result.nsmallest(10, 'ç•°å¸¸åˆ†æ•¸')[features + ['è©æ¬º', 'ç•°å¸¸åˆ†æ•¸']])
```

---

## ğŸ“ èª²å¾Œç·´ç¿’

### ç·´ç¿’ 1ï¼šåŸºç¤ç•°å¸¸åµæ¸¬
ç”¨ `make_blobs` ç”¢ç”Ÿ 500 å€‹æ­£å¸¸é»ï¼ˆ1 ç¾¤ï¼‰ï¼Œæ‰‹å‹•åŠ å…¥ 25 å€‹å‡å‹»åˆ†å¸ƒçš„
ç•°å¸¸é»ã€‚åˆ†åˆ¥ç”¨ Isolation Forest å’Œ LOF åµæ¸¬ï¼Œæ¯”è¼ƒçµæœã€‚

### ç·´ç¿’ 2ï¼šcontamination æ•æ„Ÿåº¦åˆ†æ
å»¶çºŒç·´ç¿’ 1ï¼ŒæŠŠ contamination åˆ†åˆ¥è¨­ç‚º 0.01ã€0.03ã€0.05ã€0.10ã€0.20ï¼Œ
è§€å¯Ÿåµæ¸¬çµæœå¦‚ä½•è®ŠåŒ–ã€‚ç•«å‡º precision å’Œ recall éš¨ contamination çš„è®ŠåŒ–åœ–ã€‚

### ç·´ç¿’ 3ï¼šçœŸå¯¦è³‡æ–™
ä½¿ç”¨ `sklearn.datasets.load_wine()`ï¼ŒæŠŠç¬¬ä¸€é¡ï¼ˆclass 0ï¼‰ç•¶ä½œã€Œæ­£å¸¸ã€ï¼Œ
å…¶ä»–é¡ç•¶ä½œã€Œç•°å¸¸ã€ã€‚ç”¨ Isolation Forest è©¦è©¦çœ‹èƒ½ä¸èƒ½æŠŠç•°å¸¸æ‰¾å‡ºä¾†ã€‚

### ç·´ç¿’ 4ï¼šæŒ‘æˆ°é¡Œ
çµåˆå‰ä¸‰ç« çš„çŸ¥è­˜ï¼š
1. ç”¨ PCA å°‡è³‡æ–™é™åˆ° 2D
2. ç”¨ Isolation Forest åµæ¸¬ç•°å¸¸
3. å°‡ç•°å¸¸åµæ¸¬çµæœç•«åœ¨ PCA 2D åœ–ä¸Š
4. è§€å¯Ÿç•°å¸¸é»åœ¨ PCA ç©ºé–“ä¸­çš„åˆ†å¸ƒæ˜¯å¦åˆç†

---

## ğŸ§  å‹•å‹•è…¦è§£ç­”

> ç‚ºä»€éº¼ Isolation Forest ç”¨éš¨æ©Ÿåˆ†å‰²åè€Œæœ‰æ•ˆï¼Ÿ
>
> åŸå› è·Ÿ Random Forest é¡ä¼¼ â€”â€” ã€Œéš¨æ©Ÿæ€§å¸¶ä¾†å¤šæ¨£æ€§ã€ã€‚
> æ¯æ£µéš”é›¢æ¨¹ç”¨ä¸åŒçš„éš¨æ©Ÿåˆ†å‰²ï¼Œå¦‚æœæŸå€‹é»åœ¨ã€Œå¤§å¤šæ•¸ã€æ¨¹ä¸­
> éƒ½å¾ˆå¿«è¢«éš”é›¢ï¼ˆè·¯å¾‘çŸ­ï¼‰ï¼Œé‚£å®ƒå°±æ˜¯ç©©å¥çš„ç•°å¸¸ã€‚
> å–®æ£µæ¨¹å¯èƒ½æœ‰åå·®ï¼Œä½†å¤šæ£µæ¨¹çš„ã€ŒæŠ•ç¥¨ã€çµæœå¾ˆå¯é ã€‚
> é€™å°±æ˜¯ **é›†æˆå­¸ç¿’ï¼ˆEnsemble Learningï¼‰** çš„å¨åŠ›ã€‚
>
> å¦‚æœç”¨ä¸€èˆ¬çš„æ±ºç­–æ¨¹ï¼ˆå¦‚ CARTï¼Œè¿½æ±‚æœ€ä½³åˆ†å‰²ï¼‰ï¼Œ
> åè€Œå¯èƒ½éåº¦æ“¬åˆæ­£å¸¸è³‡æ–™çš„çµæ§‹ï¼Œ
> è€Œéš¨æ©Ÿåˆ†å‰²æ›´èƒ½æ•æ‰ç•°å¸¸çš„ã€Œæ˜“éš”é›¢æ€§ã€æœ¬è³ªã€‚

---

## æœ¬ç« å›é¡§

```
+--------------------------------------------------------------+
|  æœ¬ç« å­¸åˆ°äº†                                                    |
+--------------------------------------------------------------+
|                                                              |
|  1. ç•°å¸¸åµæ¸¬ â‰  äºŒå…ƒåˆ†é¡ï¼ˆæ¥µåº¦ä¸å¹³è¡¡ã€ç¼ºä¹æ¨™ç±¤ï¼‰                 |
|  2. é›¢ç¾¤å€¼åµæ¸¬ vs æ–°ç©å€¼åµæ¸¬çš„å·®ç•°                              |
|  3. Isolation Forest = ã€Œå®¹æ˜“è¢«éš”é›¢çš„å°±æ˜¯ç•°å¸¸ã€                 |
|  4. LOF = ã€Œå¯†åº¦æ¯”é„°å±…ä½çš„å°±æ˜¯ç•°å¸¸ã€                            |
|  5. One-Class SVM = ã€Œåœ¨æ­£å¸¸è³‡æ–™å¤–ç•«é‚Šç•Œã€                     |
|  6. contamination åƒæ•¸æ§åˆ¶ç•°å¸¸æ¯”ä¾‹é–¾å€¼                          |
|  7. æ²’æœ‰æ¨™ç±¤æ™‚ï¼šäººå·¥æŠ½æŸ¥ã€åˆ†æ•¸æ’åºã€å¤šæ–¹æ³•å…±è­˜ã€æ¥­å‹™è¦å‰‡é©—è­‰      |
|  8. å¯¦å‹™ä¸­ç”¨ã€Œç•°å¸¸åˆ†æ•¸æ’åºã€æ¯”äºŒå…ƒåˆ¤æ–·æ›´æœ‰åƒ¹å€¼                   |
|                                                              |
|  æ­å–œå®Œæˆéç›£ç£å¼å­¸ç¿’çš„ä¸‰éƒ¨æ›²ï¼š                                 |
|  åˆ†ç¾¤ï¼ˆK-Meansï¼‰â†’ é™ç¶­ï¼ˆPCAï¼‰â†’ ç•°å¸¸åµæ¸¬                       |
|                                                              |
+--------------------------------------------------------------+
```
