# Ch04ï¼šæ¢ç´¢å¼è³‡æ–™åˆ†æ (EDA)

> **æœ¬ç« ç›®æ¨™**ï¼šå­¸æœƒæ‹¿åˆ°è³‡æ–™å¾Œçš„ç¬¬ä¸€æ­¥ â€” ç³»çµ±åŒ–åœ°è§€å¯Ÿã€ç†è§£ã€æå•ã€‚

---

## ğŸ”­ ä»€éº¼æ˜¯ EDAï¼Ÿ

**E**xploratory **D**ata **A**nalysisï¼ˆæ¢ç´¢å¼è³‡æ–™åˆ†æï¼‰å°±æ˜¯ï¼š

> åœ¨æ­£å¼åˆ†æä¹‹å‰ï¼Œå…ˆè·Ÿä½ çš„è³‡æ–™ã€ŒèŠä¸€èŠã€ã€‚

å°±åƒä½ å»çœ‹é†«ç”Ÿï¼Œé†«ç”Ÿä¸æœƒä¸€ä¸Šä¾†å°±é–‹åˆ€ï¼Œè€Œæ˜¯å…ˆï¼š
1. å•ä½ å“ªè£¡ä¸èˆ’æœï¼ˆäº†è§£èƒŒæ™¯ï¼‰
2. é‡é«”æº«ã€é‡è¡€å£“ï¼ˆåŸºæœ¬æª¢æŸ¥ï¼‰
3. é©—è¡€ã€ç…§ X å…‰ï¼ˆæ·±å…¥æª¢æŸ¥ï¼‰
4. ç„¶å¾Œæ‰æ±ºå®šæ²»ç™‚æ–¹æ¡ˆ

EDA å°±æ˜¯è³‡æ–™åˆ†æçš„ã€Œçœ‹è¨ºæµç¨‹ã€ã€‚

```
æ‹¿åˆ°è³‡æ–™
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. çœ‹ä¸€çœ¼   â”‚  head(), tail(), shape
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. é‡é«”æº«   â”‚  info(), dtypes
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. åšå¥æª¢   â”‚  describe(), value_counts()
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. æ‰¾å•é¡Œ   â”‚  isnull(), duplicated()
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5. æå‡èªª   â”‚  ã€ŒæŸåœ°å€æ˜¯å¦è³£å¾—æ¯”è¼ƒå¥½ï¼Ÿã€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æº–å‚™è³‡æ–™

```python
import pandas as pd

# è®€å–æ•™å­¸è³‡æ–™é›†
orders = pd.read_csv("data/orders.csv", parse_dates=["order_date"])
customers = pd.read_csv("data/customers.csv", parse_dates=["join_date"])
products = pd.read_csv("data/products.csv", parse_dates=["launch_date"])

print(f"è¨‚å–®ï¼š{orders.shape[0]} ç­†")
print(f"é¡§å®¢ï¼š{customers.shape[0]} ç­†")
print(f"å•†å“ï¼š{products.shape[0]} ç­†")
```

---

## ğŸ‘€ ç¬¬ä¸€æ­¥ï¼šçœ‹ä¸€çœ¼

### `head()` å’Œ `tail()`

```python
# çœ‹å‰ 5 ç­†
orders.head()

# çœ‹å¾Œ 3 ç­†
orders.tail(3)

# éš¨æ©ŸæŠ½ 5 ç­†ï¼ˆæ¯æ¬¡çµæœä¸åŒï¼‰
orders.sample(5)
```

> ğŸ’¡ **ç‚ºä»€éº¼è¦çœ‹ï¼Ÿ**
> - ç¢ºèªè³‡æ–™æœ‰æ²’æœ‰æ­£ç¢ºè®€å…¥
> - æ„Ÿå—ä¸€ä¸‹è³‡æ–™çš„ã€Œé•·ç›¸ã€
> - ç™¼ç¾æ˜é¡¯çš„ç•°å¸¸ï¼ˆä¾‹å¦‚æ¨™é¡Œåˆ—è¢«è®€æˆè³‡æ–™ï¼‰

### `shape` â€” å¹¾åˆ—å¹¾æ¬„ï¼Ÿ

```python
print(orders.shape)    # (100, 10) â†’ 100 ç­†è¨‚å–®ï¼Œ10 å€‹æ¬„ä½
print(f"å…± {orders.shape[0]} åˆ—ï¼Œ{orders.shape[1]} æ¬„")
```

---

## ğŸŒ¡ï¸ ç¬¬äºŒæ­¥ï¼šé‡é«”æº«

### `info()` â€” å®Œæ•´å¥åº·å ±å‘Š

```python
orders.info()
```

è¼¸å‡ºé¡ä¼¼ï¼š
```
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 100 entries, 0 to 99
Data columns (total 10 columns):
 #   Column          Non-Null Count  Dtype
---  ------          --------------  -----
 0   order_id        100 non-null    object
 1   order_date      100 non-null    datetime64[ns]
 2   customer_id     100 non-null    object
 3   product_id      98 non-null     object      â† æœ‰ 2 å€‹ç©ºå€¼ï¼
 4   quantity         100 non-null    int64
 5   unit_price      100 non-null    float64
 6   discount        100 non-null    float64
 7   region          99 non-null     object       â† æœ‰ 1 å€‹ç©ºå€¼ï¼
 8   payment_method  100 non-null    object
 9   shipping_days   97 non-null     float64      â† æœ‰ 3 å€‹ç©ºå€¼ï¼
dtypes: datetime64[ns](1), float64(3), int64(1), object(5)
memory usage: 7.9+ KB
```

### å¾ `info()` ä½ èƒ½ç™¼ç¾ä»€éº¼ï¼Ÿ

| è§€å¯Ÿé …ç›® | æ€éº¼çœ‹ | ä»£è¡¨ä»€éº¼ |
|----------|--------|----------|
| Non-Null Count | ä¸ç­‰æ–¼ç¸½åˆ—æ•¸ | æœ‰ç¼ºå¤±å€¼ |
| Dtype = object | æ–‡å­—æˆ–æ··åˆå‹æ…‹ | å¯èƒ½éœ€è¦è½‰å‹ |
| memory usage | è¨˜æ†¶é«”ä½¿ç”¨é‡ | è³‡æ–™è¦æ¨¡å¤§å° |

### `dtypes` â€” åªçœ‹å‹æ…‹

```python
orders.dtypes
```

å¸¸è¦‹å‹æ…‹å°ç…§ï¼š

| Pandas å‹æ…‹ | æ„æ€ | Python å°æ‡‰ |
|-------------|------|-------------|
| `int64` | æ•´æ•¸ | `int` |
| `float64` | æµ®é»æ•¸ | `float` |
| `object` | å­—ä¸²æˆ–æ··åˆ | `str` |
| `datetime64` | æ—¥æœŸæ™‚é–“ | `datetime` |
| `bool` | å¸ƒæ—å€¼ | `bool` |
| `category` | é¡åˆ¥ | â€” |

---

## ğŸ¥ ç¬¬ä¸‰æ­¥ï¼šåšå¥æª¢

### `describe()` â€” æ•¸å€¼çµ±è¨ˆæ‘˜è¦

```python
orders.describe()
```

è¼¸å‡ºï¼š
```
        quantity   unit_price    discount  shipping_days
count   100.000     100.000      100.000       97.000
mean      2.340     1099.800       0.055        2.650
std       1.210      654.320       0.067        1.180
min       1.000      299.000       0.000        1.000
25%       1.000      450.000       0.000        2.000
50%       2.000      890.000       0.050        2.000
75%       3.000     1290.000       0.100        3.000
max       5.000     2590.000       0.200        5.000
```

### è®€æ‡‚ `describe()` çš„æ¯å€‹æ•¸å­—

| çµ±è¨ˆé‡ | æ„ç¾© | è¦æ³¨æ„ä»€éº¼ |
|--------|------|------------|
| **count** | éç©ºå€¼æ•¸é‡ | ä¸ç­‰æ–¼ç¸½åˆ—æ•¸ â†’ æœ‰ç©ºå€¼ |
| **mean** | å¹³å‡å€¼ | å®¹æ˜“è¢«æ¥µç«¯å€¼å½±éŸ¿ |
| **std** | æ¨™æº–å·® | è¶Šå¤§è¡¨ç¤ºè³‡æ–™è¶Šåˆ†æ•£ |
| **min** | æœ€å°å€¼ | æœ‰æ²’æœ‰ä¸åˆç†çš„è² æ•¸ï¼Ÿ |
| **25%** | ç¬¬ä¸€å››åˆ†ä½æ•¸ | 25% çš„è³‡æ–™å°æ–¼æ­¤å€¼ |
| **50%** | ä¸­ä½æ•¸ | æ¯”å¹³å‡æ›´èƒ½ä»£è¡¨ã€Œå…¸å‹å€¼ã€ |
| **75%** | ç¬¬ä¸‰å››åˆ†ä½æ•¸ | 75% çš„è³‡æ–™å°æ–¼æ­¤å€¼ |
| **max** | æœ€å¤§å€¼ | æœ‰æ²’æœ‰ç•°å¸¸å¤§çš„å€¼ï¼Ÿ |

> ğŸ’¡ **å¯¦å‹™æŠ€å·§**ï¼šæ¯”è¼ƒ `mean` å’Œ `50%`ã€‚å¦‚æœå·®å¾ˆå¤šï¼Œè¡¨ç¤ºè³‡æ–™æœ‰åæ…‹ï¼ˆè¢«æ¥µç«¯å€¼æ‹‰èµ°äº†ï¼‰ã€‚

### æ–‡å­—æ¬„ä½ä¹Ÿèƒ½ describe

```python
orders.describe(include="object")
```

```
        order_id customer_id product_id region payment_method
count        100         100         98     99            100
unique        100          25          6      5              3
top        O1001        C034       P305    å°åŒ—           ä¿¡ç”¨å¡
freq            1          12         28     32             55
```

| çµ±è¨ˆé‡ | æ„ç¾© |
|--------|------|
| **count** | éç©ºå€¼æ•¸é‡ |
| **unique** | æœ‰å¤šå°‘ç¨®ä¸åŒçš„å€¼ |
| **top** | å‡ºç¾æœ€å¤šæ¬¡çš„å€¼ |
| **freq** | æœ€å¸¸å‡ºç¾çš„å€¼å‡ºç¾äº†å¹¾æ¬¡ |

---

## ğŸ“Š ç¬¬å››æ­¥ï¼šåˆ†ä½ˆè§€å¯Ÿ

### `value_counts()` â€” è¨ˆç®—å„å€¼å‡ºç¾æ¬¡æ•¸

```python
# å„åœ°å€è¨‚å–®æ•¸
orders["region"].value_counts()
```

```
å°åŒ—    32
é«˜é›„    25
å°ä¸­    20
å°å—    15
æ–°ç«¹     7
Name: region, dtype: int64
```

```python
# å„ä»˜æ¬¾æ–¹å¼ä½”æ¯”
orders["payment_method"].value_counts(normalize=True)
```

```
ä¿¡ç”¨å¡      0.55
LinePay    0.30
è²¨åˆ°ä»˜æ¬¾    0.15
Name: payment_method, dtype: float64
```

### `nunique()` â€” æœ‰å¤šå°‘ç¨®ä¸åŒçš„å€¼

```python
# æ¯å€‹æ¬„ä½æœ‰å¤šå°‘ç¨®ä¸åŒçš„å€¼
orders.nunique()
```

```
order_id          100  â† æ¯ç­†éƒ½ä¸åŒï¼ˆåˆç†ï¼‰
customer_id        25  â† 25 ä½ä¸åŒçš„é¡§å®¢
product_id          6  â† 6 ç¨®å•†å“
region              5  â† 5 å€‹åœ°å€
payment_method      3  â† 3 ç¨®ä»˜æ¬¾æ–¹å¼
...
```

---

## ğŸ” ç¬¬äº”æ­¥ï¼šæ‰¾å•é¡Œ

### ç¼ºå¤±å€¼æª¢æŸ¥

```python
# æ¯å€‹æ¬„ä½æœ‰å¤šå°‘ç©ºå€¼
orders.isnull().sum()
```

```
order_id          0
order_date        0
customer_id       0
product_id        2  â† æœ‰å•é¡Œï¼
quantity          0
unit_price        0
discount          0
region            1  â† æœ‰å•é¡Œï¼
payment_method    0
shipping_days     3  â† æœ‰å•é¡Œï¼
```

```python
# ç©ºå€¼ä½”æ¯”
(orders.isnull().sum() / len(orders) * 100).round(2)
```

### é‡è¤‡å€¼æª¢æŸ¥

```python
# æœ‰æ²’æœ‰å®Œå…¨é‡è¤‡çš„åˆ—ï¼Ÿ
orders.duplicated().sum()

# çœ‹çœ‹é‡è¤‡çš„æ˜¯å“ªäº›
orders[orders.duplicated(keep=False)]

# ä»¥ç‰¹å®šæ¬„ä½åˆ¤æ–·é‡è¤‡
orders.duplicated(subset=["order_id"]).sum()
```

### ç•°å¸¸å€¼å¿«é€Ÿåµæ¸¬

```python
# æœ‰æ²’æœ‰ä¸åˆç†çš„å€¼ï¼Ÿ
print(f"quantity ç¯„åœï¼š{orders['quantity'].min()} ~ {orders['quantity'].max()}")
print(f"unit_price ç¯„åœï¼š{orders['unit_price'].min()} ~ {orders['unit_price'].max()}")
print(f"discount ç¯„åœï¼š{orders['discount'].min()} ~ {orders['discount'].max()}")

# è² æ•¸æª¢æŸ¥
print(f"è² æ•¸ quantityï¼š{(orders['quantity'] < 0).sum()}")
print(f"è² æ•¸ unit_priceï¼š{(orders['unit_price'] < 0).sum()}")
```

---

## ğŸ“‹ EDA æª¢æŸ¥æ¸…å–®

æ¯æ¬¡æ‹¿åˆ°æ–°è³‡æ–™ï¼Œç…§é€™å€‹é †åºèµ°ä¸€éï¼š

```python
def quick_eda(df, name="DataFrame"):
    """å¿«é€Ÿ EDA å‡½å¼"""
    print(f"{'='*50}")
    print(f"ğŸ“Š {name} åŸºæœ¬è³‡è¨Š")
    print(f"{'='*50}")
    print(f"å½¢ç‹€ï¼š{df.shape[0]} åˆ— Ã— {df.shape[1]} æ¬„")
    print(f"\n--- å‹æ…‹ ---")
    print(df.dtypes)
    print(f"\n--- ç¼ºå¤±å€¼ ---")
    missing = df.isnull().sum()
    if missing.sum() > 0:
        print(missing[missing > 0])
    else:
        print("ç„¡ç¼ºå¤±å€¼ âœ…")
    print(f"\n--- é‡è¤‡å€¼ ---")
    dup_count = df.duplicated().sum()
    print(f"å®Œå…¨é‡è¤‡ï¼š{dup_count} ç­†")
    print(f"\n--- æ•¸å€¼çµ±è¨ˆ ---")
    print(df.describe().round(2))
    print(f"\n--- é¡åˆ¥çµ±è¨ˆ ---")
    for col in df.select_dtypes(include="object").columns:
        print(f"\n{col}ï¼ˆ{df[col].nunique()} ç¨®ï¼‰ï¼š")
        print(df[col].value_counts().head(5))

# ä½¿ç”¨
quick_eda(orders, "è¨‚å–®è³‡æ–™")
```

---

## ğŸ§ª å‹•æ‰‹ç·´ç¿’

### ç·´ç¿’ 1ï¼šåŸºæœ¬ EDA

```python
# å° customers.csv åšå®Œæ•´ EDA
customers = pd.read_csv("data/customers.csv")

# 1. æœ‰å¤šå°‘ä½é¡§å®¢ï¼Ÿ
# 2. ç”·å¥³æ¯”ä¾‹ï¼Ÿ
# 3. å¹´é½¡åˆ†ä½ˆï¼Ÿï¼ˆæœ€å°ã€æœ€å¤§ã€å¹³å‡ï¼‰
# 4. å„åŸå¸‚çš„é¡§å®¢æ•¸é‡ï¼Ÿ
# 5. å„æœƒå“¡ç­‰ç´šçš„åˆ†ä½ˆï¼Ÿ
# 6. æœ‰æ²’æœ‰ç¼ºå¤±å€¼ï¼Ÿ
```

### ç·´ç¿’ 2ï¼šäº¤å‰è§€å¯Ÿ

```python
# ç”¨ orders.csv å›ç­”ä»¥ä¸‹å•é¡Œï¼š
# 1. å“ªå€‹åœ°å€çš„è¨‚å–®æœ€å¤šï¼Ÿ
# 2. æœ€å—æ­¡è¿çš„ä»˜æ¬¾æ–¹å¼æ˜¯ä»€éº¼ï¼Ÿ
# 3. å¹³å‡æ¯ç­†è¨‚å–®è²·å¹¾ä»¶å•†å“ï¼Ÿ
# 4. æŠ˜æ‰£é€šå¸¸æ˜¯å¤šå°‘ï¼Ÿ
# 5. å‡ºè²¨å¤©æ•¸å¹³å‡å¤šä¹…ï¼Ÿ
```

### ç·´ç¿’ 3ï¼šå¯«ä½ è‡ªå·±çš„ EDA å ±å‘Š

```python
# é¸ä¸€å¼µè¡¨ï¼ˆorders / customers / productsï¼‰
# å¯«ä¸€æ®µ 200 å­—çš„ EDA æ‘˜è¦ï¼ŒåŒ…å«ï¼š
# - è³‡æ–™è¦æ¨¡
# - ä¸»è¦ç™¼ç¾
# - æ½›åœ¨å•é¡Œ
# - å»ºè­°çš„ä¸‹ä¸€æ­¥
```

---

## â— å¸¸è¦‹éŒ¯èª¤èˆ‡é™·é˜±

### é™·é˜± 1ï¼šåªçœ‹ `mean` ä¸çœ‹ `median`

```python
# å¦‚æœæœ‰æ¥µç«¯å€¼ï¼Œmean æœƒè¢«æ‹‰èµ°
# ä¾‹å¦‚ï¼š[100, 200, 300, 400, 10000]
# mean = 2200 ğŸ˜±
# median = 300  â† æ›´èƒ½ä»£è¡¨ã€Œå¤§å¤šæ•¸ã€
```

### é™·é˜± 2ï¼šå¿½ç•¥ `object` å‹æ…‹çš„æ•¸å€¼æ¬„ä½

```python
# æœ‰æ™‚å€™æ•¸å€¼æ¬„ä½è¢«è®€æˆ objectï¼ˆå› ç‚ºè£¡é¢æ··äº†æ–‡å­—ï¼‰
# ä¾‹å¦‚ "1,290" æˆ– "N/A"
df.dtypes  # unit_price é¡¯ç¤º objectï¼Ÿé‚£å°±æœ‰å•é¡Œäº†

# è§£æ³•
df["unit_price"] = pd.to_numeric(df["unit_price"], errors="coerce")
```

### é™·é˜± 3ï¼š`describe()` åªé¡¯ç¤ºæ•¸å€¼æ¬„ä½

```python
# é è¨­åªé¡¯ç¤ºæ•¸å€¼
df.describe()

# è¦çœ‹å…¨éƒ¨
df.describe(include="all")

# åªçœ‹æ–‡å­—
df.describe(include="object")
```

---

## ğŸ”‘ æœ¬ç« é‡é»å›é¡§

| å‡½å¼ | ç”¨é€” | é‡é» |
|------|------|------|
| `head()` / `tail()` | çœ‹å‰å¹¾ç­† / å¾Œå¹¾ç­† | ç¬¬ä¸€å°è±¡ |
| `shape` | åˆ—æ•¸ Ã— æ¬„æ•¸ | è³‡æ–™è¦æ¨¡ |
| `info()` | å®Œæ•´è³‡è¨Š | å‹æ…‹ + ç©ºå€¼ |
| `describe()` | çµ±è¨ˆæ‘˜è¦ | åˆ†ä½ˆ + ç•°å¸¸ |
| `value_counts()` | è¨ˆæ•¸ | é¡åˆ¥åˆ†ä½ˆ |
| `nunique()` | ä¸é‡è¤‡å€¼æ•¸é‡ | æ¬„ä½ç‰¹æ€§ |
| `isnull().sum()` | ç©ºå€¼è¨ˆæ•¸ | è³‡æ–™å“è³ª |
| `duplicated().sum()` | é‡è¤‡å€¼è¨ˆæ•¸ | è³‡æ–™å“è³ª |

**EDA çš„æ ¸å¿ƒç²¾ç¥**ï¼šå…ˆç†è§£è³‡æ–™ï¼Œå†åšåˆ†æã€‚ä¸è¦æ€¥è‘—è·‘æ¨¡å‹ï¼

---

## â­ï¸ ä¸‹ä¸€ç« é å‘Š

> **Ch05ï¼šè³‡æ–™æ¸…ç†çš„è—è¡“**
>
> EDA æ‰¾åˆ°äº†å•é¡Œï¼ˆç©ºå€¼ã€ç•°å¸¸å€¼ã€é‡è¤‡å€¼...ï¼‰ï¼Œ
> ä¸‹ä¸€ç« æ•™ä½ æ€éº¼å„ªé›…åœ°è™•ç†å®ƒå€‘ã€‚

---

[â† Ch03ï¼šè³‡æ–™çš„é€²èˆ‡å‡º](ch03-data-io.md) | [Ch05ï¼šè³‡æ–™æ¸…ç†çš„è—è¡“ â†’](ch05-data-cleaning.md)
