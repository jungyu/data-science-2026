# 附錄 A — 快速參考卡

> 所有關鍵概念的速查表。列印出來放在桌上！

---

## Agent 核心循環

```
感知 → 推理 → 行動 → 觀察 → 感知 ...
```

---

## 工具速查

| 目的 | 工具 | 範例 |
|------|------|------|
| 找檔案 | Glob | `**/*.config.ts` |
| 找程式碼 | Grep | `"TODO"`, `"function.*auth"` |
| 讀檔案 | Read | `/src/app.js` |
| 改檔案 | Edit | `Edit(file, old, new)` |
| 建檔案 | Write | `Write(path, content)` |
| 跑命令 | Bash | `npm test`, `git status` |
| 搜網路 | WebSearch | `"React 19 features"` |
| 管任務 | TodoWrite | 建立/更新待辦清單 |
| 委派 | Task | 啟動子 Agent |

---

## MCP 伺服器速查

| 伺服器 | 用途 | 標誌 |
|--------|------|------|
| Context7 | 查函式庫文件 | `--c7` |
| Sequential | 深度分析推理 | `--seq` |
| Magic | UI 元件生成 | `--magic` |
| Playwright | 瀏覽器測試 | `--play` |
| 全部啟用 | 複雜任務 | `--all-mcp` |
| 全部停用 | 簡單任務 | `--no-mcp` |

### 思考深度

| 標誌 | 深度 | 適用 |
|------|------|------|
| `--think` | ~4K tokens | 模組級 |
| `--think-hard` | ~10K tokens | 系統級 |
| `--ultrathink` | ~32K tokens | 關鍵級 |

---

## 四層防護體系

```
L0  憲法原則     不可妥協，永遠遵守
L1  決策日誌     臨時決策，可升級/廢棄
L2  人類審查     危險操作前必須人類確認
L3  語意禁止     程式碼層級的絕對禁令
```

---

## 人類審查三級制

| 級別 | 行為 | 範例 |
|------|------|------|
| 🔴 L1 MUST STOP | 立即停止等核准 | DB 遷移、Auth 修改 |
| 🟡 L2 SHOULD CONFIRM | 通知並等確認 | 新增依賴、改 API |
| 🟢 L3 NOTIFY AFTER | 做完後通知 | 改規則、大量重命名 |

---

## SDD-BDD-TDD 工作流

### 四句咒語

```
/specify  — 說清楚要做什麼
/clarify  — 把模糊的問清楚
/plan     — 畫一張施工藍圖
/implement — 按圖施工步步驗證
```

### 四問題複雜度評估

| 問題 | 0 分 | 有分 |
|------|------|------|
| 涉及多少模組？ | 1 個 | 2+ 個 (2分) |
| 有權限/並發/不可逆？ | 沒有 | 有 (3分) |
| 涉及 DB Schema？ | 不涉及 | 涉及 (2分) |
| 涉及外部 API？ | 不涉及 | 涉及 (2分) |

- 0-2 分 → Lite
- 3-5 分 → Standard
- 6+ 分 → Full

---

## 8 步品質驗證

```
1. 語法檢查    — 能不能跑？
2. 型別檢查    — 型別對嗎？
3. 程式碼規範  — 符合 Lint？
4. 安全掃描    — 有漏洞嗎？
5. 測試執行    — 測試過嗎？
6. 效能評估    — 效能退化？
7. 文件檢查    — 文件更新？
8. 整合驗證    — 系統配合？
```

---

## Token 預算指南

| 操作 | 目標 | 上限 |
|------|------|------|
| 簡單修改 | 5K | 10K |
| 中等任務 | 15K | 30K |
| 複雜任務 | 30K | 60K |
| 研究分析 | 10K | 20K |

---

## 提示工程速查

### 結構化指令

```
1. 目標（What + Why）
2. 位置（Where）
3. 約束（How + 限制）
4. 範例（Example）
5. 驗收（Done = ?）
```

### 常用模式

| 模式 | 用法 | 效果 |
|------|------|------|
| 角色扮演 | 「假設你是資安工程師...」 | 聚焦特定視角 |
| 正反對比 | 「比較方案 A 和方案 B」 | 避免偏見 |
| 漸進細化 | 列出 → 深入 → 修復 | 從廣到窄 |
| 約束反轉 | 「先告訴我風險」 | 發現盲點 |
| 範例驅動 | 「格式如下：...」 | 精確輸出 |

---

## 多 Agent 模式

| 模式 | 適用場景 | 特點 |
|------|---------|------|
| 主從委派 | 可平行的獨立任務 | 速度快 |
| 專家小組 | 需要多角度分析 | 深度高 |
| 流水線 | 有順序依賴的步驟 | 結構化 |

### 何時用多 Agent？

```
✅ 檔案 > 10、可平行、多視角、上下文不夠
❌ 檔案 < 5、強依賴、預算有限
```

---

## 記憶系統

| 檔案 | 用途 | 更新頻率 |
|------|------|---------|
| constitution.md | 不可變原則 | 很少 |
| diary.md | 技術決策 | 每次決策 |
| patterns.md | 有效/失敗模式 | 發現時 |
| context.md | 專案背景 | 重大變化時 |

---

## 治理框架目錄結構

```
project/
├── CLAUDE.md                # Agent 總指令
├── memory/
│   ├── constitution.md      # L0 憲法
│   ├── diary.md             # L1 決策
│   ├── patterns.md          # 模式記憶
│   └── context.md           # 專案脈絡
├── rules/
│   ├── semantic-deny.md     # L3 語意禁止
│   └── human-review.md      # L2 人類審查
├── config/
│   ├── settings.json        # 權限設定
│   └── token-budget.yaml    # Token 預算
├── templates/               # 範本庫
└── logs/                    # 操作日誌
```

---

> 📖 完整內容請回到 [README](README.md) 查看各章節
