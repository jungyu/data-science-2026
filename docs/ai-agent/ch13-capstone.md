# Ch13 â€” ç•¢æ¥­å°ˆæ¡ˆï¼šæ‰“é€ ä½ çš„ Agent æ²»ç†æ¡†æ¶

> **ã€Œå­¸ç¿’çš„æœ€é«˜å¢ƒç•Œï¼Œæ˜¯èƒ½å¤ æ•™åˆ¥äººã€‚ã€**

---

## ğŸ¯ æœ¬ç« å­¸ç¿’ç›®æ¨™

å®Œæˆé€™ç« ï¼Œä½ å°‡èƒ½å¤ ï¼š

- [ ] å¾é›¶å»ºç«‹ä¸€å€‹å®Œæ•´çš„ Agent æ²»ç†æ¡†æ¶
- [ ] å°‡æ‰€æœ‰å­¸åˆ°çš„çŸ¥è­˜æ•´åˆåˆ°å¯¦éš›å°ˆæ¡ˆä¸­
- [ ] ç‚ºåœ˜éšŠè¨­è¨ˆå¯æ“´å±•çš„æ²»ç†ç³»çµ±
- [ ] æŒçºŒæ¼”åŒ–å’Œæ”¹é€²ä½ çš„æ¡†æ¶

---

## ç•¢æ¥­å°ˆæ¡ˆæ¦‚è¿°

### ä½ è¦æ‰“é€ ä»€éº¼ï¼Ÿ

ä¸€å€‹**å®Œæ•´çš„ Agent æ²»ç†æ¡†æ¶**ï¼ŒåŒ…å«ä»¥ä¸‹å…ƒä»¶ï¼š

```
ä½ çš„æ²»ç†æ¡†æ¶/
â”œâ”€â”€ CLAUDE.md                # Agent ç¸½æŒ‡ä»¤
â”œâ”€â”€ memory/
â”‚   â”œâ”€â”€ constitution.md      # æ²»ç†æ†²æ³•ï¼ˆL0ï¼‰
â”‚   â”œâ”€â”€ diary.md             # æ±ºç­–æ—¥èªŒï¼ˆL1ï¼‰
â”‚   â”œâ”€â”€ patterns.md          # æ¨¡å¼è¨˜æ†¶
â”‚   â””â”€â”€ context.md           # å°ˆæ¡ˆè„ˆçµ¡
â”œâ”€â”€ rules/
â”‚   â”œâ”€â”€ semantic-deny.md     # èªæ„ç¦æ­¢ï¼ˆL3ï¼‰
â”‚   â””â”€â”€ human-review.md      # äººé¡å¯©æŸ¥ï¼ˆL2ï¼‰
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ settings.json        # Agent æ¬Šé™è¨­å®š
â”‚   â””â”€â”€ token-budget.yaml    # Token é ç®—
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ spec-template.md     # è¦æ ¼ç¯„æœ¬
â”‚   â””â”€â”€ task-template.md     # ä»»å‹™ç¯„æœ¬
â””â”€â”€ logs/
    â””â”€â”€ README.md            # æ—¥èªŒæ ¼å¼èªªæ˜
```

---

## Step 1ï¼šå®šç¾©ä½ çš„æ†²æ³•

### 1.1 è­˜åˆ¥æ ¸å¿ƒåŸå‰‡

å›ç­”ä»¥ä¸‹å•é¡Œï¼š

```
1. ä½ çš„å°ˆæ¡ˆæœ€é‡è¦çš„å“è³ªæ˜¯ä»€éº¼ï¼Ÿ
   â–¡ å®‰å…¨æ€§    â–¡ æ•ˆèƒ½    â–¡ å¯ç¶­è­·æ€§
   â–¡ ä½¿ç”¨è€…é«”é©—  â–¡ å¯é æ€§

2. ä»€éº¼éŒ¯èª¤æ˜¯ä½ çµ•å°ç„¡æ³•æ¥å—çš„ï¼Ÿ
   ï¼ˆåˆ—å‡º 3-5 å€‹ï¼‰

3. ä½ çš„åœ˜éšŠæœ€å¸¸çŠ¯çš„æŠ€è¡“éŒ¯èª¤æ˜¯ä»€éº¼ï¼Ÿ
   ï¼ˆåˆ—å‡º 3 å€‹ï¼‰
```

### 1.2 æ’°å¯« constitution.md

```markdown
# å°ˆæ¡ˆæ†²æ³• â€” [ä½ çš„å°ˆæ¡ˆåç¨±]

> ä»¥ä¸‹åŸå‰‡ä¸å¯å¦¥å”ã€‚

## Principle I: [ä½ çš„ç¬¬ä¸€åŸå‰‡]
- è¦å‰‡ï¼š[å…·é«”è¦å‰‡]
- ç†ç”±ï¼š[ç‚ºä»€éº¼ä¸å¯å¦¥å”]
- é©—è­‰ï¼š[å¦‚ä½•æª¢æŸ¥]

## Principle II: [ä½ çš„ç¬¬äºŒåŸå‰‡]
...

## Principle III: [ä½ çš„ç¬¬ä¸‰åŸå‰‡]
...
```

---

## Step 2ï¼šè¨­å®šç´…ç·šè¦å‰‡

### 2.1 èªæ„ç¦æ­¢è¦å‰‡

æ ¹æ“šä½ çš„å°ˆæ¡ˆï¼Œå¾ä»¥ä¸‹æ¨¡æ¿ä¸­é¸æ“‡æˆ–è‡ªè¨‚ï¼š

```markdown
# èªæ„ç¦æ­¢è¦å‰‡

## é€šç”¨
- [ ] GEN-001: [ä½ çš„è¦å‰‡]
- [ ] GEN-002: [ä½ çš„è¦å‰‡]

## å®‰å…¨
- [ ] SEC-001: [ä½ çš„è¦å‰‡]
- [ ] SEC-002: [ä½ çš„è¦å‰‡]

## æ¶æ§‹
- [ ] AR-001: [ä½ çš„è¦å‰‡]

## å°ˆæ¡ˆç‰¹å®š
- [ ] PRJ-001: [ä½ çš„å°ˆæ¡ˆç‰¹æœ‰è¦å‰‡]
```

### 2.2 äººé¡å¯©æŸ¥è§¸ç™¼

```markdown
# äººé¡å¯©æŸ¥è§¸ç™¼è¦å‰‡

## L1 â€” å¿…é ˆåœæ­¢
- [ ] [ä½ çš„ L1 è¦å‰‡]
- [ ] [ä½ çš„ L1 è¦å‰‡]

## L2 â€” æ‡‰è©²ç¢ºèª
- [ ] [ä½ çš„ L2 è¦å‰‡]
- [ ] [ä½ çš„ L2 è¦å‰‡]

## L3 â€” äº‹å¾Œé€šçŸ¥
- [ ] [ä½ çš„ L3 è¦å‰‡]
```

---

## Step 3ï¼šå»ºç«‹è¨˜æ†¶ç³»çµ±

### 3.1 Decision Diary

è¨˜éŒ„ä½ å°ˆæ¡ˆç›®å‰çš„ 3 å€‹é—œéµæ±ºç­–ï¼š

```markdown
# Decision Diary

## [æ—¥æœŸ] [æ±ºç­– 1]
Context: ...
Decision: ...
Rationale: ...
Status: active

## [æ—¥æœŸ] [æ±ºç­– 2]
...

## [æ—¥æœŸ] [æ±ºç­– 3]
...
```

### 3.2 å°ˆæ¡ˆè„ˆçµ¡

```markdown
# å°ˆæ¡ˆè„ˆçµ¡

## èƒŒæ™¯
[ä¸€æ®µè©±æè¿°å°ˆæ¡ˆ]

## æŠ€è¡“é¸æ“‡
[åˆ—å‡ºä¸»è¦æŠ€è¡“å’Œé¸æ“‡åŸå› ]

## åœ˜éšŠ
[åœ˜éšŠè¦æ¨¡å’Œçµ„æˆ]

## å·²çŸ¥æŠ€è¡“å‚µ
[åˆ—å‡º 3-5 å€‹]
```

---

## Step 4ï¼šè¨­å®š CLAUDE.md

æŠŠæ‰€æœ‰å…ƒä»¶ä¸²èµ·ä¾†ï¼š

```markdown
# CLAUDE.md â€” [å°ˆæ¡ˆåç¨±]

## æŠ€è¡“å †ç–Š
- Language: [èªè¨€]
- Framework: [æ¡†æ¶]
- Database: [è³‡æ–™åº«]
- Testing: [æ¸¬è©¦æ¡†æ¶]

## æ²»ç†åƒè€ƒ
- æ†²æ³•ï¼šmemory/constitution.md
- æ±ºç­–æ—¥èªŒï¼šmemory/diary.md
- ç¦æ­¢è¦å‰‡ï¼šrules/semantic-deny.md
- å¯©æŸ¥è§¸ç™¼ï¼šrules/human-review.md

## ç·¨ç¢¼è¦ç¯„
[åˆ—å‡º 5-10 æ¢è¦ç¯„]

## Agent è¦å‰‡
- ä¿®æ”¹è¶…é 5 å€‹æª”æ¡ˆæ™‚å…ˆå±•ç¤ºè¨ˆç•«
- åšæŠ€è¡“æ±ºç­–æ™‚å…ˆæŸ¥ diary.md
- å®Œæˆä»»å‹™å¾ŒåŸ·è¡Œå“è³ªæª¢æŸ¥
- è§¸ç™¼ L1 è¦å‰‡æ™‚ç«‹å³åœæ­¢
```

---

## Step 5ï¼šè¨­å®šå“è³ªç®¡ç·š

### å»ºç«‹ validate å‘½ä»¤

```json
{
  "scripts": {
    "validate": "npm run lint && npm run typecheck && npm test",
    "lint": "eslint . --max-warnings 0",
    "typecheck": "tsc --noEmit",
    "test": "vitest run"
  }
}
```

### åœ¨ CLAUDE.md ä¸­åŠ å…¥

```markdown
## å“è³ªæª¢æŸ¥
- æ¯æ¬¡ä¿®æ”¹å¾ŒåŸ·è¡Œï¼šnpm run validate
- æ–°å¢åŠŸèƒ½å¿…é ˆæœ‰æ¸¬è©¦
- æäº¤å‰ç¢ºèªæ‰€æœ‰æª¢æŸ¥é€šé
```

---

## Step 6ï¼šé©—è­‰ä½ çš„æ¡†æ¶

### é©—è­‰æ¸…å–®

ç”¨ä»¥ä¸‹å ´æ™¯æ¸¬è©¦ä½ çš„æ²»ç†æ¡†æ¶ï¼š

```
â–¡ å ´æ™¯ 1ï¼šè®“ Agent ä¿®ä¸€å€‹ç°¡å–®çš„ Bug
  â†’ æ¡†æ¶ä¸æœƒéåº¦å¹²é å—ï¼Ÿ

â–¡ å ´æ™¯ 2ï¼šè®“ Agent åšä¸€å€‹ä¸­ç­‰åŠŸèƒ½
  â†’ å·¥ä½œæµç¨‹é †æš¢å—ï¼Ÿå“è³ªå¯æ¥å—å—ï¼Ÿ

â–¡ å ´æ™¯ 3ï¼šè®“ Agent å˜—è©¦åšä¸€å€‹è¢«ç¦æ­¢çš„æ“ä½œ
  â†’ ç´…ç·šè¦å‰‡æœ‰æ•ˆå—ï¼Ÿ

â–¡ å ´æ™¯ 4ï¼šè®“ Agent åšä¸€å€‹éœ€è¦å¯©æŸ¥çš„æ“ä½œ
  â†’ äººé¡å¯©æŸ¥è§¸ç™¼æ­£ç¢ºå—ï¼Ÿ

â–¡ å ´æ™¯ 5ï¼šè®“ Agent åšä¸€å€‹æŠ€è¡“æ±ºç­–
  â†’ å®ƒæœ‰æŸ¥çœ‹ diary å—ï¼Ÿæœ‰è¨˜éŒ„å—ï¼Ÿ
```

### è¿­ä»£æ”¹å–„

```
ç¬¬ä¸€è¼ªé©—è­‰å¾Œï¼Œä½ å¯èƒ½æœƒç™¼ç¾ï¼š

- æŸäº›è¦å‰‡å¤ªåš´æ ¼ â†’ æ”¾å¯¬æˆ–é™ç´š
- æŸäº›å ´æ™¯æ²’è¢«è¦†è“‹ â†’ å¢åŠ è¦å‰‡
- æŸäº›æ ¼å¼ä¸æ–¹ä¾¿ â†’ èª¿æ•´æ¨¡æ¿
- æŸäº›å·¥ä½œæµå¤ªæ…¢ â†’ ç°¡åŒ–æ­¥é©Ÿ

é€™æ˜¯æ­£å¸¸çš„ã€‚æ²»ç†æ¡†æ¶æ˜¯æ´»çš„ï¼Œéœ€è¦æŒçºŒæ¼”åŒ–ã€‚
```

---

## å­¸ç¿’è·¯å¾‘å›é¡§

```
ä½ èµ°éçš„è·¯ï¼š

Ch01  ç‚ºä»€éº¼éœ€è¦ Agentï¼Ÿ        â† ç†è§£åƒ¹å€¼
Ch02  Agent çš„å¤§è…¦è§£å‰–å­¸        â† ç†è§£åŸç†
Ch03  ä½ çš„ç¬¬ä¸€å€‹ Agent          â† å‹•æ‰‹é«”é©—
Ch04  æç¤ºå·¥ç¨‹                  â† å­¸æœƒæºé€š
Ch05  SDD Ã— BDD Ã— TDD         â† é–‹ç™¼æµç¨‹
Ch06  å·¥å…·èˆ‡ MCP               â† èƒ½åŠ›æ“´å±•
Ch07  æ²»ç†æ†²æ³•                  â† å»ºç«‹åŸå‰‡
Ch08  ç´…ç·šèˆ‡è­·æ¬„                â† è¨­å®šé‚Šç•Œ
Ch09  è¨˜æ†¶èˆ‡æ±ºç­–                â† æŒçºŒæˆé•·
Ch10  å“è³ªé–˜é–€                  â† ç¢ºä¿å“è³ª
Ch11  å¤š Agent å”ä½œ             â† åœ˜éšŠå”ä½œ
Ch12  èµ°å‘ç”Ÿç”¢                  â† å¯¦éš›éƒ¨ç½²
Ch13  ç•¢æ¥­å°ˆæ¡ˆ                  â† æ•´åˆå¯¦è¸  â˜… ä½ åœ¨é€™è£¡
```

---

## æŒçºŒç²¾é€²çš„å»ºè­°

### 1. å®šæœŸå›é¡§

```
æ¯æœˆå›é¡§ï¼š
- constitution.md æ˜¯å¦éœ€è¦æ›´æ–°ï¼Ÿ
- diary ä¸­æœ‰å“ªäº›æ±ºç­–éœ€è¦å‡ç´šæˆ–å»¢æ£„ï¼Ÿ
- patterns.md æœ‰æ–°çš„æœ‰æ•ˆæ¨¡å¼å—ï¼Ÿ
- Token ä½¿ç”¨æ•ˆç‡å¦‚ä½•ï¼Ÿ
```

### 2. é—œæ³¨ç¤¾ç¾¤

```
AI Agent é ˜åŸŸå¿«é€Ÿç™¼å±•ï¼ŒæŒçºŒé—œæ³¨ï¼š
- æ–°çš„ Agent èƒ½åŠ›å’Œå·¥å…·
- ç¤¾ç¾¤çš„æœ€ä½³å¯¦è¸
- å®‰å…¨å’Œæ²»ç†çš„æ–°æ–¹æ³•
- æ–°çš„ MCP ä¼ºæœå™¨å’Œæ•´åˆ
```

### 3. åˆ†äº«ç¶“é©—

```
ä½ çš„æ²»ç†æ¡†æ¶å¯ä»¥ï¼š
- åˆ†äº«çµ¦åœ˜éšŠçš„å…¶ä»–æˆå“¡
- é–‹æºçµ¦ç¤¾ç¾¤åƒè€ƒ
- åœ¨æŠ€è¡“æ–‡ç« ä¸­åˆ†äº«ç¶“é©—
- åœ¨åœ˜éšŠå›é¡§ä¸­è¨è«–æ”¹é€²
```

---

## ç•¢æ¥­æ¸…å–®

åœ¨ä½ å®Œæˆç•¢æ¥­å°ˆæ¡ˆä¹‹å‰ï¼Œç¢ºèªä»¥ä¸‹æ¯ä¸€é …éƒ½å·²å®Œæˆï¼š

```
åŸºç¤ç¯‡
â–¡ ç†è§£ AI Agent çš„æ ¸å¿ƒæ¦‚å¿µ
â–¡ èƒ½å€åˆ† AI å·¥å…·å’Œ AI Agent
â–¡ å·²å®‰è£ä¸¦ä½¿ç”¨é Claude Code
â–¡ èƒ½å¯«çµæ§‹åŒ–çš„ Agent æŒ‡ä»¤

å¯¦æˆ°ç¯‡
â–¡ ç†è§£ SDD-BDD-TDD å·¥ä½œæµ
â–¡ èƒ½ä½¿ç”¨å››å•é¡Œæ³•è©•ä¼°è¤‡é›œåº¦
â–¡ ç†è§£ MCP å’Œ Tool Use

æ²»ç†ç¯‡
â–¡ å·²æ’°å¯« constitution.md
â–¡ å·²è¨­è¨ˆèªæ„ç¦æ­¢è¦å‰‡
â–¡ å·²å»ºç«‹äººé¡å¯©æŸ¥è§¸ç™¼æ©Ÿåˆ¶
â–¡ å·²å»ºç«‹è¨˜æ†¶ç³»çµ±ï¼ˆdiary + patterns + contextï¼‰
â–¡ å·²è¨­å®šå“è³ªé–˜é–€

é€²éšç¯‡
â–¡ ç†è§£å¤š Agent å”ä½œæ¨¡å¼
â–¡ å·²è¨­å®š Token é ç®—
â–¡ å·²å»ºç«‹æ“ä½œæ—¥èªŒæ ¼å¼
â–¡ å·²å®Œæˆå®Œæ•´çš„æ²»ç†æ¡†æ¶
```

---

## çµèª

> **ä½ å·²ç¶“å¾ä¸€å€‹ AI Agent çš„ã€Œä½¿ç”¨è€…ã€ï¼Œæˆé•·ç‚ºä¸€å€‹ã€Œæ²»ç†è€…ã€ã€‚**
>
> è¨˜ä½ï¼š
> - Agent çš„èƒ½åŠ›æœƒè¶Šä¾†è¶Šå¼·ï¼Œä½†æ²»ç†çš„å¿…è¦æ€§ä¸æœƒæ¶ˆå¤±
> - å¥½çš„æ²»ç†ä¸æ˜¯é™åˆ¶ Agentï¼Œè€Œæ˜¯ç¢ºä¿å®ƒçš„åŠ›é‡è¢«æ­£ç¢ºé‹ç”¨
> - æ²»ç†æ¡†æ¶æ˜¯æ´»çš„ï¼Œéœ€è¦å’Œå°ˆæ¡ˆä¸€èµ·æˆé•·
>
> **æ­å–œç•¢æ¥­ï¼ç¾åœ¨å»æ‰“é€ æ›´å¥½çš„è»Ÿé«”å§ã€‚**

---

## é™„éŒ„åƒè€ƒ

- [é™„éŒ„ A â€” å¿«é€Ÿåƒè€ƒå¡](appendix-a-cheatsheet.md)ï¼šæŒ‡ä»¤ã€è¦å‰‡ã€æ¨¡å¼é€ŸæŸ¥è¡¨
- [é™„éŒ„ B â€” æ•™å­¸æŒ‡å—](appendix-b-teaching-guide.md)ï¼š18 é€±èª²ç¨‹è¦åŠƒ

---

> ğŸ“– **é…å¥—è³‡æº**ï¼šå®Œæ•´çš„ç”Ÿç”¢ç´šæ²»ç†æ¡†æ¶è«‹åƒè€ƒ `agent-init/` ç›®éŒ„
